<!-- TODO needs a close button for small resolutions -->
<div id="{{elementId}}" data-ng-cloak>
    <div ng-if="model.pending" data-layout="row" data-layout-padding data-layout-margin data-layout-align="space-around center" data-layout-wrap>
        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
    </div>
    <div data-ng-if="model.completed && !model.pending && !model.data.ListingId && !model.data.ListingKey"
         class="no-results"
         data-layout="row" data-layout-padding data-layout-margin data-layout-align="space-around center" data-layout-wrap
    >
        This listing is no longer available
    </div>
    <!-- parallax-wrapper disabled, cannot use height altering on the entire popup widget -->
    <div data-ng-if="model.completed && (model.data.ListingId || model.data.ListingKey)">

        <div class="details-header static-element">
            <h1 class="address">
                <span data-ng-bind="::getStreetAddress()"></span>
            </h1>
            <h4>
                <span data-ng-bind="::model.data.City"></span>
                <!-- If not CA, what about model.data.StateOrProvince? -->
            </h4>
        </div>

        <div class="gallery-video-container static-element" data-ng-if="model.data.Images && model.data.Images.length > 0">
            <stratus-swiper-carousel
                    init-now="model.completed"
                    slides="images"
            ></stratus-swiper-carousel>
            <!-- autoplay="true" -->
            <!-- pagination='{"clickable":true,"render":"numberBullet"}' -->
        </div>
        <div class="gallery-fallback" data-ng-if="!model.data.Images || (model.data.Images && model.data.Images.length < 1)">
            <img data-ng-src="{{::localDir}}images/no-image.jpg">
        </div>


        <div class="about-container details-container static-element">
            <div class="clearfix">
                <div class="details-left">
                    <h2>About</h2>

                    <ul class="details-specs primary_font">
                        <li>
                            <!-- TODO need a prettier word for the status and a detail of real status -->
                            <span data-ng-bind="::model.data.MlsStatus"></span>
                        </li>
                        <li data-ng-if="::model.data.BedroomsTotal > 0">
                            <span data-ng-bind="::model.data.BedroomsTotal"></span> Beds
                        </li>
                        <li data-ng-if="::model.data.BathroomsFull > 0 || model.data.BathroomsTotalInteger > 0">
                            <span data-ng-bind="::model.data.BathroomsFull || model.data.BathroomsTotalInteger"></span> Baths
                        </li>
                        <li data-ng-if="::model.data.BathroomsHalf > 0">
                            <span data-ng-bind="::model.data.BathroomsHalf"></span> Half Baths
                        </li>
                        <li data-ng-if="::model.data.BathroomsOneQuarter > 0">
                            <span data-ng-bind="::model.data.BathroomsOneQuarter"></span> Quarter Baths
                        </li>
                        <li data-ng-if="::model.data.BathroomsPartial > 0">
                            <span data-ng-bind="::model.data.BathroomsPartial"></span> Partial Baths
                        </li>
                        <li data-ng-if="::model.data.BuildingAreaTotal">
                            <span data-ng-bind="::model.data.BuildingAreaTotal | number"></span> Square Feet
                        </li>
                        <li data-ng-if="::model.data.DaysOnMarket">
                            Days on Market: <span data-ng-bind="::model.data.DaysOnMarket | number"></span>
                        </li>
                        <li data-ng-if="::model.data.ArchitecturalStyle">
                            Style: <span data-ng-bind="::model.data.ArchitecturalStyle"></span>
                        </li>
                        <li data-ng-if="::model.data.YearBuilt">
                            Built in <span data-ng-bind="::model.data.YearBuilt"></span>
                        </li>
                        <li data-ng-if="::model.data.LotSizeArea">
                            Lot: <span data-ng-bind="::model.data.LotSizeArea | number"></span>
                            <span data-ng-if="::model.data.LotSizeUnits">
								<span data-ng-bind="::model.data.LotSizeUnits"></span>
							</span>
                        </li>
                        <li data-ng-if="!model.data.LotSizeArea && model.data.LotSizeAcres">
                            Lot: <span data-ng-bind="::model.data.LotSizeAcres"></span> Acres
                        </li>
                        <li data-ng-if="::model.data.PoolPrivateYN">
                            With Pool
                        </li>
                        <li data-ng-if="::model.data.Stories">
                            Stories: <span data-ng-bind="::model.data.Stories"></span>
                        </li>
                        <li data-ng-if="::model.data.PropertyType">
                            <span data-ng-bind="::model.data.PropertyType"></span>
                        </li>
                        <li data-ng-if="::model.data.PropertySubType && model.data.PropertySubType != model.data.PropertyType">
                            <span data-ng-bind="::model.data.PropertySubType"></span>
                        </li>
                        <li class="mls-service" data-ng-if="::model.data.ListingId || model.data.ListingKey">
                            <span data-ng-bind="getMLSName()"></span>#
                            <span data-ng-bind="::model.data.ListingId || model.data.ListingKey"></span>
                        </li>
                    </ul>

                </div>
                <div class="details-right">
                    <div class="list-price font-secondary" data-ng-if="::model.data.ClosePrice || model.data.ListPrice">
                        <span class="list-price-label" data-ng-bind="model.data.ClosePrice ? 'Sold for' : 'Listed at'"></span>
                        <span class="list-price" data-ng-bind="'$' + (model.data.ClosePrice || model.data.ListPrice | number)"></span>
                    </div>
                    <!-- TODO need a decent way to make a title for Property listings -->
                    <!--h3 class="property-title">An exclusive haven destined for modern, indoor-outdoor entertaining</h3-->
                    <div class="font-body description" data-ng-if="::model.data.PublicRemarks" data-ng-bind="::model.data.PublicRemarks"></div>
                    <div class="response-container">
                        <a class="vtour btn btn-alt" data-ng-if="::model.data.VirtualTourURLUnbranded || model.data.VirtualTourURLBranded" data-ng-href="{{::model.data.VirtualTourURLUnbranded || model.data.VirtualTourURLBranded}}" target="_blank">VTour</a>
                        <!-- TODO no support for files other than images at this time -->
                        <!--a class="download-PDF btn btn-alt" href="">Download PDF</a-->
                    </div>
                </div>
            </div>
        </div>

        <!-- Temporary Open House -->
        <div class="open-house-container details-container accent-bg-color static-element"
             data-ng-if="model.data.OpenHouses && model.data.OpenHouses.length"
        >
            <div class="open-house">
                <div class="clearfix">
                    <div class="details-left">
                        <h2>Open</h2>
                        <p class="remarks primary_font">
                            Please join us for an open showing of this property on the following dates:
                        </p>
                    </div>
                    <div class="details-right">
                        <!-- repeat
                        <div class="open-house-item">
                            <div class="month primary_font">
                                February
                            </div>
                            <div data-layout-gt-xs="row" data-layout-align-gt-xs="space-between center">
                                <div class="primary_font" data-layout="row" data-layout-align="space-between center">
                                    <div class="day">8</div>
                                    <div class="day-weekday-time-agent">
                                        Saturday @ 11:30pm - 4:30pm <br>with Mads Mikkelson
                                    </div>
                                </div>
                                <a class="add-to-calendar btn btn-alt">
                                    Add to Calendar
                                </a>
                            </div>
                        </div>
                        <div class="open-house-item">
                            <div class="month primary_font">
                                February
                            </div>
                            <div data-layout-gt-xs="row" data-layout-align-gt-xs="space-between center">
                                <div class="primary_font" data-layout="row" data-layout-align="space-between center">
                                    <div class="day">9</div>
                                    <div class="day-weekday-time-agent">
                                        Saturday @ 11:30pm - 4:30pm
                                    </div>
                                </div>
                                <a class="add-to-calendar btn btn-alt">
                                    Add to Calendar
                                </a>
                            </div>
                        </div>
                        -->

                        <div class="open-house-item"
                             data-ng-repeat="openHouse in model.data.OpenHouses"
                             id="{{'open_house_' + openHouse.OpenHouseKey}}"
                        >
                            <!-- FIXME Daniela, do we wish to show the Open House descriptions that are possible on each open house? -->
                            <div class="month primary_font"
                                 data-ng-bind="::openHouse.OpenHouseStartTime | moment:{unix:false,format:'MMMM'}"
                            ></div>
                            <div data-layout-gt-xs="row" data-layout-align-gt-xs="space-between center">
                                <div class="primary_font" data-layout="row" data-layout-align="space-between center">
                                    <div class="day" data-ng-bind="::openHouse.OpenHouseStartTime | moment:{unix:false,format:'D'}"></div>
                                    <div class="day-weekday-time-agent">
                                        <span data-ng-bind="::openHouse.OpenHouseStartTime | moment:{unix:false,format:'dddd MMM Do, h:mm a'}"></span>
                                        <span data-ng-if="::openHouse.OpenHouseEndTime"> —
                                            <span data-ng-bind="::openHouse.OpenHouseEndTime | moment:{unix:false,format:'h:mm a'}"></span>
                                        </span>
                                        <span data-ng-if="::openHouse.ShowingAgentFirstName">
                                            <br/>
                                            with <span data-ng-bind="::openHouse.ShowingAgentFirstName"></span> <span data-ng-bind="::openHouse.ShowingAgentLastName"></span>
                                        </span>
                                    </div>
                                </div>
                                <!-- TODO Need to create ics functionality
                                <a class="add-to-calendar btn btn-alt">
                                    Add to Calendar
                                </a>
                                -->
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Real open house
            <div class="details-container open-house-section accent-bg-color" data-ng-if="model.data.OpenHouses && model.data.OpenHouses.length">
                <h2>Open</h2>
                <div class="open-house-container dotted-spaced-sideline">
                    <span class="primary_font" data-ng-if="::model.data.OpenHouses[0].OpenHouseRemarks" data-ng-bind="::model.data.OpenHouses[0].OpenHouseRemarks"></span>
                    <div class="open-house" id="{{'open_house_' + openHouse.OpenHouseId}}" data-ng-repeat="openHouse in model.data.OpenHouses">
                        <span data-ng-bind="::openHouse.OpenHouseStartTime | moment:{unix:false,format:'dddd MMM Do, h:mm a'}"></span>
                        <span data-ng-if="::openHouse.OpenHouseEndTime"> —
                                <span data-ng-bind="::openHouse.OpenHouseEndTime | moment:{unix:false,format:'h:mm a'}"></span>
                            </span>
                        <span data-ng-if="::openHouse.ShowingAgentFirstName">
                                with <span data-ng-bind="::openHouse.ShowingAgentFirstName"></span> <span data-ng-bind="::openHouse.ShowingAgentLastName"></span>
                            </span>
                    </div>
                </div>
            </div>-->
        </div>

        <!-- This needs to display the second image in the slideshow or maybe the last image? -->
        <!-- parallax-element disabled, cannot use height altering on the entire widget -->
        <div class="secondary-image-container">
            <!-- TODO data-ng-click="return cms.obj.listtrac.track('lead');"-->
            <!--a data-ng-href="/site/contact?comments={{::getFullAddress(true)}}" target="_blank">Contact</a-->
            <a class="btn btn-alt btn-contact" target="_blank" data-ng-href="/site/contact?comments={{::getFullAddress(true)}}">
                Contact
            </a>
            <div class="image-dimmer"></div>
            <!-- parallax-content disabled, cannot use height altering on the entire widget -->
            <!-- FIXME {} can't be used in inline styles as it won't resolve before the page loads (or may not exist) -->
            <div data-ng-if="model.data.Images && model.data.Images[0]"
                 style="background: url('{{::model.data.Images[0].MediaURL}}') no-repeat center center; background-size: cover;"
            >
                <img data-ng-if="model.data.Images && model.data.Images.length > 0" data-ng-src="{{::localDir}}images/stratus-property-shapeholder.png" alt="{{::getStreetAddress()}}"/>
                <img data-ng-if="!model.data.Images" data-ng-src="{{::localDir}}images/no-image-simple.jpg">
            </div>
        </div>

        <div class="map-location details-container static-element" data-ng-if="::getFullAddress()">
            <h2 class="dotted-spaced-underline">Location</h2>
            <iframe data-ng-src="{{::getGoogleMapEmbedUrl()}}" class="google-map-embed"></iframe>
        </div>
        <!-- TODO: Should only show if it's a personal listing and sitemap or floorplan exist -->
        <!-- TODO: data-layout and data-flex should only exist if both floorplan and siteplan exist -->
        <!--
        <div class="schematics details-container static-element">
            <h2>Schematics</h2>

            <div class="schematics-container clearfix">
                <div class="schematics-column floorplan">
                    <div class="schematics-image floorplan-image">
                        <a href="">
                            <data-md-tooltip>Click to enlarge</data-md-tooltip>
                            <img data-ng-src="{{::localDir}}images/temporary-floorplan.png" alt="Site Plan"/>
                        </a>
                    </div>
                    <h4>Floorplan</h4>
                    <a class="btn-download" href="">
                        <data-md-tooltip>Download Floorplan</data-md-tooltip>
                    </a>
                </div>
                <div class="schematics-column siteplan">
                    <div class="schematics-image siteplan-image">
                        <a href="">
                            <data-md-tooltip>Click to enlarge</data-md-tooltip>
                            <img data-ng-src="{{::localDir}}images/temporary-siteplan.png" alt="Site Plan"/>
                        </a>
                    </div>
                    <h4>Siteplan</h4>
                    <a class="btn-download" href="">
                        <data-md-tooltip>Download Siteplan</data-md-tooltip>
                    </a>
                </div>
            </div>
        </div>
        -->

        <div class="additional-details details-container static-element">
            <h2 class="dotted-spaced-underline">More</h2>
            <!-- TODO Missing quite a number of minor details -->
            <!-- TODO Wishlist, would love to replace sections with Masonry ability https://passy.github.io/angular-masonry/ -->

            <div>
                <div class="detail-sections">
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Size & Style"
                            items='{
                                "YearBuilt": "Built",
                                "Stories": "Stories",
                                "StructureType": "Structure Type",
                                "LivingArea": {"name": "Living Area", "comma": true},
                                "LotSizeAcres": {"name": "Lot Size", "append": " Acres", "comma": true},
                                "LotSizeSquareFeet": {"name": "Lot Size", "append": " SqFt", "comma": true},
                                "LotSizeArea": {"name": "Lot Size", "comma": true},
                                "HorseYN": {"true": "Horse Property: Yes", "false": ""}
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Materials"
                            items='{
                                "Roof": "Roof",
                                "Flooring": "Flooring",
                                "Flooring": "Flooring",
                                "WindowFeatures": "Windows",
                                "DoorFeatures": "Doors",
                                "FoundationDetails": "Foundation",
                                "FoundationArea": "Foundation",
                                "ConstructionMaterials": "Construction"
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Utilities"
                            items='{
                                "CoolingYN": {"true": "Cooling: Yes", "false": ""},
                                "Cooling": "Cooling",
                                "HeatingYN": {"true": "Heating: Yes", "false": ""},
                                "Heating": "Heating",
                                "Utilities": "Utilities",
                                "Electric": "Electric",
                                "WaterSource": "Water",
                                "Sewer": "Sewer Septic"
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Area"
                            items='{
                                "CrossStreet": "Cross Street",
                                "PostalCode": "Postal Code",
                                "CityRegion": "City Region",
                                "Township": "Township",
                                "CountyOrParish": "County",
                                "MLSAreaMajor": "Area",
                                "SubdivisionName": "Subdivision",
                                "StateOrProvince": "State",
                                "StateRegion": "State Region"
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Features"
                            items='{
                                "HorseAmenities": "Horse Amenities",
                                "PoolPrivateYN": {"true": "Pool: Yes", "false": ""},
                                "PoolFeatures": "Pool",
                                "SpaYN": {"true": "Spa: Yes", "false": ""},
                                "SpaFeatures": "Spa",
                                "LaundryFeatures": "Laundry",
                                "Appliances": "Appliances",
                                "FireplaceYN": {"true": "Fireplace: Yes", "false": ""},
                                "FireplaceFeatures": "Fireplace",
                                "FireplacesTotal": "Fireplaces",
                                "YearBuilt": "Additional Rooms",
                                "InteriorFeatures": "Interior Features",
                                "SecurityFeatures": "Security Features",
                                "ExteriorFeatures": "Exterior Features",
                                "BuildingFeatures": "Building Features",
                                "AccessibilityFeatures": "Accessibility",
                                "PatioAndPorchFeatures": "Patio And Porch",
                                "Fencing": "Fencing",
                                "FrontageType": "Frontage",
                                "OtherEquipment": "Equipment",
                                "CommunityFeatures": "Community"
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Parking"
                            items='{
                                "ParkingTotal": "Parking Spaces",
                                "GarageYN": {"true": "Garage: Yes", "false": ""},
                                "GarageSpaces": "Garage Spaces",
                                "AttachedGarageYN": {"true": "Attached Garage", "false": ""},
                                "CarportYN": {"true": "Carport: Yes", "false": ""},
                                "CarportSpaces": "Carport Spaces",
                                "CoveredSpaces": "Covered Spaces",
                                "OpenParkingSpaces": "Open Spaces",
                                "OtherParking": "Other Parking",
                                "ParkingFeatures": "Parking"
                            }'
                    >
                    </stratus-idx-property-details-sub-section>
                    <stratus-idx-property-details-sub-section
                            ng-model="model"
                            section-name="Sources"
                            items='{
                                "FinancialDataSource": "Financial Data",
                                "LotSizeSource": "Lot Size",
                                "LotDimensionsSource": "Lot Dimensions",
                                "LivingAreaSource": "Living Area",
                                "BuildingAreaSource": "Building Area",
                                "FarmLandAreaSource": "Farm Land Area",
                                "YearBuiltSource": "Year Built",
                                "MapCoordinateSource": "Map Coordinate",
                                "ListAOR": {"name": "Listing AOR"},
                                "OriginatingSystemName": {"name": "Originating System"},
                                "OriginatingSystemKey": {"name": "Originating System", "prepend": "# "}
                            }'
                    >
                    </stratus-idx-property-details-sub-section>

                    <!-- Agent section -->
                    <div class="property-details-sub-section">
                        <div class="sub-detail-section">
                            <div class="section-name">Agent</div>
                            <div class="sub-detail" data-ng-if="getListAgentName()">
                                <span class="item-label">Listing Agent: </span>
                                <span data-ng-bind="::getListAgentName()"></span><span data-ng-if="::model.data.ListAgentStateLicense"> (DRE# <span data-ng-bind="::model.data.ListAgentStateLicense"></span>)</span><span data-ng-if="::model.data.ListOfficeName">, <span data-ng-bind="::model.data.ListOfficeName"></span></span>
                            </div>
                            <div class="sub-detail" data-ng-if="getCoListAgentName()">
                                <span class="item-label">Co-Listing Agent: </span>
                                <span data-ng-bind="::getCoListAgentName()"></span><span data-ng-if="::model.data.CoListAgentStateLicense"> (DRE# <span data-ng-bind="::model.data.CoListAgentStateLicense"></span>)</span><span data-ng-if="::model.data.CoListOfficeName">, <span data-ng-bind="::model.data.CoListOfficeName"></span></span>
                            </div>
                            <div class="sub-detail" data-ng-if="getBuyerAgentName()">
                                <span class="item-label">Buyer Agent: </span>
                                <span data-ng-bind="::getBuyerAgentName()"></span><span data-ng-if="::model.data.BuyerAgentStateLicense"> (DRE# <span data-ng-bind="::model.data.BuyerAgentStateLicense"></span>)</span><span data-ng-if="::model.data.BuyerOfficeName">, <span data-ng-bind="::model.data.BuyerOfficeName"></span></span>
                            </div>
                            <div class="sub-detail" data-ng-if="getCoBuyerAgentName()">
                                <span class="item-label">Co-Buyer Agent: </span>
                                <span data-ng-bind="::getCoBuyerAgentName()"></span><span data-ng-if="::model.data.CoBuyerAgentStateLicense"> (DRE# <span data-ng-bind="::model.data.CoBuyerAgentStateLicense"></span>)</span><span data-ng-if="::model.data.CoBuyerOfficeName">, <span data-ng-bind="::model.data.CoBuyerOfficeName"></span></span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Real Additional Details
            <div class="agent-section">
                <div class="agent underline-top" data-ng-if="getListAgentName()">
                    <strong>Listing Agent: </strong>
                    <span data-ng-bind="::getListAgentName()"></span><span data-ng-if="::model.data.ListOfficeName">, <span data-ng-bind="::model.data.ListOfficeName"></span></span>
                </div>
                <div class="agent dotted-spaced-underline underline-top" data-ng-if="getCoListAgentName()">
                    <strong>Co-Listing Agent: </strong>
                    <span data-ng-bind="::getCoListAgentName()"></span><span data-ng-if="::model.data.CoListOfficeName">, <span data-ng-bind="::model.data.CoListOfficeName"></span></span>
                </div>
                <div class="agent dotted-spaced-underline underline-top" data-ng-if="getBuyerAgentName()">
                    <strong>Buyer Agent: </strong>
                    <span data-ng-bind="::getBuyerAgentName()"></span><span data-ng-if="::model.data.BuyerOfficeName">, <span data-ng-bind="::model.data.BuyerOfficeName"></span></span>
                </div>
                <div class="agent dotted-spaced-underline underline-top" data-ng-if="getCoBuyerAgentName()">
                    <strong>Co-Buyer Agent: </strong>
                    <span data-ng-bind="::getCoBuyerAgentName()"></span><span data-ng-if="::model.data.CoBuyerOfficeName">, <span data-ng-bind="::model.data.CoBuyerOfficeName"></span></span>
                </div>
            </div>-->


        </div>

        <!-- Contact area needs dynamic variables -->
        <div class="contact-container details-container static-element"
             data-ng-show="::contactName || contactPhoneNumber || contactEmail"
        >
            <h2>Contact</h2>
            <p class="primary_font">
                <span class="site-name" data-ng-show="::contactName" data-ng-bind="::contactName"></span>
                <span class="phone" data-ng-show="::contactPhone">
                    <a data-ng-href="tel:{{::contactPhone}}" data-ng-bind="::contactPhone"></a>
                </span>
                <span class="email" data-ng-show="::contactEmail">
                    <a data-ng-href="mailto:{{::contactEmail}}" data-ng-bind="::contactEmail" target="_blank"></a>
                </span>
            </p>
        </div>

        <div class="disclaimer-container details-container static-element">
            <div class="disclaimer"
                 data-ng-class="{'border-top': (contactName || contactPhoneNumber || contactEmail)}"
                 data-ng-bind-html="::getMLSDisclaimer(true)"
            ></div>
        </div>
    </div>
    <div data-ng-if="model.data.length == 0 || model.error" class="error details-container">
        Sorry, the property you requested could not be found. Perhaps there was an error and trying again will solve the
        problem.
    </div>

</div>
