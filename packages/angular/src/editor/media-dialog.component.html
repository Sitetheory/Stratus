<h1 mat-dialog-title>Media Selector</h1>

<div mat-dialog-content class="media-dialog-content">
    <!-- Target Editor -->
    <form class="dialog-form" [formGroup]='dialogMediaForm'>
        <mat-form-field class="form-field">
            <input matInput placeholder="Search Media" aria-label="Search Media" formControlName='mediaQueryInput'>
        </mat-form-field>
    </form>
    <mat-progress-bar mode="indeterminate" *ngIf="isMediaLoading"></mat-progress-bar>
    <mat-grid-list cols="3" rowHeight="2:1">
        <ng-container *ngFor="let mediaEntity of mediaEntities">
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc !== null">
                <img [src]="mediaEntity.thumbSrc"
                     [alt]="mediaEntity.name"
                     [style.cursor]="'pointer'"
                     [ngClass]="{'selected' : isSelected(mediaEntity)}"
                     (click)="select(mediaEntity)">
            </mat-grid-tile>
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && mediaEntity.mime === 'video'">
                <ng-container *ngIf="mediaEntity.service === 'vimeo'">
                    <ng-container *ngIf="mediaEntity.meta && mediaEntity.meta.thumbnail_large; else basicVimeoButton">
                        <img [src]="mediaEntity.meta.thumbnail_large"
                             [alt]="mediaEntity.name"
                             [style.cursor]="'pointer'"
                             [ngClass]="{'selected' : isSelected(mediaEntity)}"
                             (click)="select(mediaEntity)">
                    </ng-container>
                    <ng-template #basicVimeoButton>
                        <i class="fas fa-video"></i>&nbsp;
                        <i class="fab fa-vimeo"></i>&nbsp;
                        <span [innerText]="mediaEntity.name"></span>
                        <i class="fas fa-video"></i>
                    </ng-template>
                </ng-container>
                <ng-container *ngIf="mediaEntity.service === 'youtube'">
                    <ng-container *ngIf="mediaEntity.serviceMediaId; else basicYoutubeButton">
                        <img [src]="'https://img.youtube.com/vi/' + mediaEntity.serviceMediaId + '/hqdefault.jpg'"
                             [alt]="mediaEntity.name"
                             [style.cursor]="'pointer'"
                             [ngClass]="{'selected' : isSelected(mediaEntity)}"
                             (click)="select(mediaEntity)">
                    </ng-container>
                    <ng-template #basicYoutubeButton>
                        <i class="fas fa-video"></i>&nbsp;
                        <i class="fab fa-youtube"></i>&nbsp;
                        <span [innerText]="mediaEntity.name"></span>
                    </ng-template>
                </ng-container>
                <ng-container *ngIf="mediaEntity.service === 'facebook'">
                    <div [style.cursor]="'pointer'"
                         [ngClass]="{'selected' : isSelected(mediaEntity)}"
                         (click)="select(mediaEntity)">
                        <i class="fas fa-video"></i>&nbsp;
                        <i class="fab fa-facebook"></i>&nbsp;
                        <span [innerText]="mediaEntity.name"></span>
                    </div>
                </ng-container>
                <ng-container *ngIf="!['vimeo', 'youtube', 'facebook'].includes(mediaEntity.service)">
                    <i class="fas fa-video"></i>&nbsp;
                    <i class="fab fa-code"></i>&nbsp;
                    <span [innerText]="mediaEntity.name"></span>
                </ng-container>
            </mat-grid-tile>
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && _.startsWith(mediaEntity.mime, 'audio')">
                <!-- TODO: make this a local file -->
                <img src="/assets/1/0/bundles/sitetheorymedia/images/mediaTypeGraphics/media-graphic-audio.png"
                     style="background: #4e4e4e;"
                     [alt]="mediaEntity.name"
                     [style.cursor]="'pointer'"
                     [ngClass]="{'selected' : isSelected(mediaEntity)}"
                     (click)="select(mediaEntity)">
            </mat-grid-tile>
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && mediaEntity.mime === 'application/pdf'">
                <!-- TODO: make this a local file -->
                <img src="/assets/1/0/bundles/sitetheorymedia/images/mediaTypeGraphics/media-graphic-pdf.png"
                     [alt]="mediaEntity.name"
                     [style.cursor]="'pointer'"
                     [ngClass]="{'selected' : isSelected(mediaEntity)}"
                     (click)="select(mediaEntity)">
            </mat-grid-tile>
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && mediaEntity.mime === 'application/msword'">
                <!-- TODO: make this a local file -->
                <img src="/assets/1/0/bundles/sitetheorymedia/images/mediaTypeGraphics/media-graphic-doc.png"
                     [alt]="mediaEntity.name"
                     [style.cursor]="'pointer'"
                     [ngClass]="{'selected' : isSelected(mediaEntity)}"
                     (click)="select(mediaEntity)">
            </mat-grid-tile>
            <!-- In some cases, there are external images with a service of 'directlink' -->
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && mediaEntity.service === 'directlink'
                                  && mediaEntity.file">
                <img [src]="mediaEntity.file"
                     [alt]="mediaEntity.name"
                     [style.cursor]="'pointer'"
                     [ngClass]="{'selected' : isSelected(mediaEntity)}"
                     (click)="select(mediaEntity)">
            </mat-grid-tile>

            <!-- Note: This shows info for entities that don't have a proper display -->
            <!--
            <mat-grid-tile *ngIf="mediaEntity.thumbSrc === null
                                  && !_.startsWith(mediaEntity.mime, 'audio')
                                  && !['application/pdf', 'application/msword', 'video'].includes(mediaEntity.mime)"
                                  && !(mediaEntity.service === 'directlink' && mediaEntity.file)>
                <span [innerText]="mediaEntity.id"></span>&nbsp;
                <span [innerText]="mediaEntity.mime|json"></span>&nbsp;
                <span [innerText]="mediaEntity.service|json"></span>
            </mat-grid-tile>
            -->
        </ng-container>
    </mat-grid-list>
    <!-- Pagination is based on the latest Convoy Meta -->
    <mat-paginator [length]="(!meta || !meta.pagination) ? mediaEntities.length : (meta.pagination.countTotal || mediaEntities.length)"
                   [pageSize]="(!meta || !meta.pagination) ? limit : (meta.pagination.limit || limit)"
                   [pageSizeOptions]="[5, 10, 25, 50, 100]"
                   (page)="onPage($event)">
    </mat-paginator>
</div>
