!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular"],factory):factory(root.Stratus,root._,root.$,root.angular)}(this,function(Stratus,_,$,angular){Stratus.Directives.OnScreen=function($parse,$interpolate){return{restrict:"A",scope:{onScreen:"@onScreen",stratusOnScreen:"@stratusOnScreen",offScreen:"@offScreen",spy:"@spy",target:"@target",partial:"@partial",update:"@update",animation:"@animation",event:"@event",offset:"@offset",reset:"@reset"},link:function(scope,element,attrs){element.uid=_.uniqueId("on_screen_"),Stratus.Instances[element.uid]=scope,scope.elementId=attrs.elementId||element.uid;let $element=element instanceof $?element:$(element),event=attrs.event?attrs.event.split(" "):[],target=attrs.target?$(attrs.target):$element,spy=attrs.spy?$(attrs.spy):$element;spy.length||(spy=$element);let partial=_.hydrate(attrs.partial);"boolean"!=typeof partial&&(partial=!0);let update=_.hydrate(attrs.update);"number"!=typeof update&&(update=100);let animation=_.hydrate(attrs.animation);"number"!=typeof animation&&(animation=!1);let lastUpdate=0,isWaiting=!1,wasOnScreen=!1,wipeJob=!1,offset=_.hydrate(attrs.offset)||0,reset=_.hydrate(attrs.reset)||0,wipe=function(request){animation&&(_.isUndefined(request)?(wipeJob&&clearTimeout(wipeJob),wipeJob=setTimeout(function(){wipe(!0)},animation)):target.removeClass("reveal conceal"))},calculate=function(){if(-1!==event.indexOf("reset")&&(reset>0&&$element.offset().top<=reset||$(window).scrollTop()<=0))return target.removeClass("onScreen offScreen scrollUp scrollDown reveal conceal"),void target.addClass("reset");!function(){if(isWaiting)return wasOnScreen;let calculation=(new Date).getTime();return calculation-lastUpdate>update?(lastUpdate=calculation,wasOnScreen=Stratus.Internals.IsOnScreen(spy,offset,partial)):(isWaiting=!0,setTimeout(function(){isWaiting=!1,calculate()},lastUpdate+update-calculation+1)),wasOnScreen}()?(target.hasClass("onScreen")&&target.removeClass("onScreen"),target.hasClass("offScreen")||target.addClass("offScreen"),!attrs.offScreen||"function"!=typeof attrs.offScreen||attrs.offScreen()):(target.hasClass("onScreen")||target.addClass("onScreen onScreenInit"),target.hasClass("offScreen")&&target.removeClass("offScreen"),!attrs.onScreen||"function"!=typeof attrs.onScreen||attrs.onScreen())};Stratus.Internals.OnScroll(),Stratus.Environment.on("change:viewPortChange",calculate),Stratus.Environment.on("change:lastScroll",function(){let lastScroll=Stratus.Environment.get("lastScroll");"down"!==lastScroll||target.hasClass("reset")||(target.hasClass("scrollDown")||target.addClass("scrollDown"),target.hasClass("scrollUp")&&target.removeClass("scrollUp"),animation&&Stratus.Internals.IsOnScreen(spy,offset,partial)&&(target.hasClass("reveal")&&target.removeClass("reveal"),target.hasClass("conceal")||target.addClass("conceal"),wipe())),"up"===lastScroll&&(target.hasClass("scrollUp")||target.addClass("scrollUp"),target.hasClass("scrollDown")&&target.removeClass("scrollDown"),target.hasClass("reset")&&target.removeClass("reset"),animation&&(target.hasClass("reveal")||target.addClass("reveal"),target.hasClass("conceal")&&target.removeClass("conceal"),wipe()))})}}}});