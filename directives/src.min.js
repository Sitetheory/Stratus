!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Directives.Src=function($parse,$interpolate){return{restrict:"A",scope:{stratusSrc:"@stratusSrc"},link:function($scope,$element){Stratus.Instances[_.uniqueId("src_")]=$scope,$scope.whitelist=["jpg","jpeg","png"],$scope.registered=!1,$scope.register=function(){if($scope.registered)return!0;var ext=$element.attr("src")?$element.attr("src").match(/\.([0-9a-z]+)(\?.*)?$/i):null;ext&&(ext=ext[1]?ext[1].toLowerCase():null);var filter=_.filter($scope.whitelist,function(value){return ext===value});return _.size(filter)<1||($scope.registered=!0,$element.attr("data-src","lazy"),$scope.group={method:Stratus.Internals.LoadImage,el:$element,spy:$element.data("spy")?Stratus($element.data("spy")):$element},Stratus.RegisterGroup.add("OnScroll",$scope.group),Stratus.Internals.LoadImage($scope.group),void Stratus.Internals.OnScroll())},$scope.src=$element.attr("src")||$element.attr("stratus-src"),$scope.interpreter=$interpolate($scope.src,!1,null,!0),$scope.initial=$scope.interpreter($scope.$parent),angular.isDefined($scope.initial)?($element.attr("src",$scope.initial),$scope.register()):$scope.$watch(function(){return $scope.interpreter($scope.$parent)},function(value){angular.isDefined(value)&&($element.attr("src",value),$scope.register())})}}}});