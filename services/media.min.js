!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","stratus.services.utility"],t):t(e.Stratus,e._,e.jQuery,e.angular)}(this,function(e,t,n,r){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","utility",function(e,r,a,u,i){var o="/Api/Tag",l="/Api/Media";return{dragenter:function(e){n("#main").addClass("blurred")},dragleave:function(e){n("#main").removeClass("blurred")},createTag:function(e){return i.sendRequest(e,"POST",o)},uploadToS3:d,deleteMedia:function(e){return i.sendRequest(null,"DELETE",l+"/"+e)},updateMedia:function(e,t){return i.sendRequest(t,"PUT",l+"/"+e)},getMedia:function(e){var t=e.collection.meta.data.pagination.pageCurrent;return null==t?e.collection.fetch():e.collection.page(t)},fileUploader:function(e,t){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=d(e,t),e.upload.then(function(t){e.result=t.data,e.errorUpload=!1},function(t){e.errorUpload=!0,e.errorMsg=t.config.data.file.upload.aborted?"Aborted":"Server Error! Please try again"}),e.upload.progress(function(t){e.progress=0===t.total?0:Math.min(100,parseInt(100*t.loaded/t.total))}),e},saveMediaUrl:function(e){return i.sendRequest(e,"POST",l)},fetchOneMedia:function(e){return i.sendRequest(null,"GET",l+"/"+e)},getThumbnailImgOfVideo:function(e){return"youtube"===e.service?"https://img.youtube.com/vi/"+s(e.file)+"/0.jpg":"vimeo"===e.service&&e.meta.thumbnail_medium?e.meta.thumbnail_medium:"https://img.youtube.com/vi/default.jpg"},getYouTubeID:s};function d(e,n){var r="//app.sitetheory.io:3000/?session="+t.cookie("SITETHEORY")+(n?"&id="+n:"");return u.upload({url:r,method:"POST",data:{key:e.name,acl:"private","Content-Type":""!==e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}function s(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return t&&11===t[7].length?t[7]:""}}])}]});