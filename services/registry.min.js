!function(t,e){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.collection","stratus.services.model"],e):e(t.Stratus,t._,t.angular)}(this,function(t,e,a){t.Services.Registry=["$provide",function(i){i.factory("Registry",["Collection","Model","$interpolate",function(i,r,o){return class n{constructor(){this.fetch=this.fetch.bind(this)}fetch(t,i){return new Promise(function(r,c){a.isString(t)&&(t={target:t});const l={target:t.attr?t.attr("data-target"):t.target,targetSuffix:t.attr?t.attr("data-target-suffix"):t.targetSuffix,id:t.attr?t.attr("data-id"):t.id,manifest:t.attr?t.attr("data-manifest"):t.manifest,decouple:t.attr?t.attr("data-decouple"):t.decouple,direct:t.attr?t.attr("data-direct"):t.direct,api:t.attr?t.attr("data-api"):t.api,urlRoot:t.attr?t.attr("data-url-root"):t.urlRoot};let s=0;i.$watch(function(){return s},function(t){e.isNumber(t)&&parseInt(t)===e.size(l)&&r(n.build(l,i))}),e.each(l,function(t,e){if(t&&a.isString(t)){const r=o(t,!1,null,!0),n=r(i.$parent);a.isDefined(n)?(l[e]=n,s++):i.$watch(function(){return r(i.$parent)},function(t){t&&(l[e]=t,s++)})}else s++})})}static build(o,n){let c;if(o.target){if(o.target=e.ucfirst(o.target),o.manifest||o.id){t.Catalog[o.target]||(t.Catalog[o.target]={});const e=o.id||"manifest";if(o.decouple||!t.Catalog[o.target][e]){const a={target:o.target,manifest:o.manifest,stagger:!0};o.urlRoot&&(a.urlRoot=o.urlRoot),o.targetSuffix&&(a.targetSuffix=o.targetSuffix),c=new r(a,{id:o.id}),o.decouple||(t.Catalog[o.target][e]=c)}else t.Catalog[o.target][e]&&(c=t.Catalog[o.target][e])}else{const e=o.direct?"Compendium":"Catalog";if(t[e][o.target]||(t[e][o.target]={}),o.decouple||!t[e][o.target].collection){const a={target:o.target,direct:!!o.direct};o.urlRoot&&(a.urlRoot=o.urlRoot),o.targetSuffix&&(a.targetSuffix=o.targetSuffix),c=new i(a),o.decouple||(t[e][o.target].collection=c)}else t[e][o.target].collection&&(c=t[e][o.target].collection)}o.api&&c.meta.set("api",e.isJSON(o.api)?JSON.parse(o.api):o.api),c.stagger&&"function"==typeof c.initialize&&c.initialize()}return a.isObject(c)&&(void 0!==n&&(n.data=c,c instanceof r?n.model=c:c instanceof i&&(n.collection=c)),c.pending||c.completed||c.fetch()),c}}}])}]});