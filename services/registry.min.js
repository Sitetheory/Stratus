!function(t,e){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.collection","stratus.services.model"],e):e(t.Stratus,t._,t.angular)}(this,function(t,e,a){t.Services.Registry=["$provide",function(a){a.factory("Registry",["Collection","Model","$interpolate",function(a,r,i){return t.Prototypes.AngularRegistry=t.Prototypes.AngularRegistry||class o{constructor(){this.fetch=this.fetch.bind(this)}fetch(a,r){return new Promise(function(n,c){"string"==typeof a&&(a={target:a});const l={target:a.attr?a.attr("data-target"):a.target,targetSuffix:a.attr?a.attr("data-target-suffix"):a.targetSuffix,id:a.attr?a.attr("data-id"):a.id,manifest:a.attr?a.attr("data-manifest"):a.manifest,decouple:a.attr?a.attr("data-decouple"):a.decouple,direct:a.attr?a.attr("data-direct"):a.direct,api:a.attr?a.attr("data-api"):a.api,urlRoot:a.attr?a.attr("data-url-root"):a.urlRoot};let u=0,s=function(){e.isNumber(u)&&u===e.size(l)&&n(o.build(l,r))};e.each(l,function(a,o){if(!a||"string"!=typeof a)return u++,void s();const n=i(a,!1,null,!0),c=n(r.$parent);if(void 0!==c)return l[o]=c,u++,void s();t.Environment.get("production")||console.log("poll attribute:",o),e.poll(function(){return n(r.$parent)},7500,250).then(function(e){t.Environment.get("production")||console.log("interpreted:",e),void 0!==e&&(l[o]=e,u++,s())}).catch(function(t){console.error(t)})})})}static build(i,o){let n;if(i.target){if(i.target=e.ucfirst(i.target),i.manifest||i.id){t.Catalog[i.target]||(t.Catalog[i.target]={});const e=i.id||"manifest";if(i.decouple||!t.Catalog[i.target][e]){const a={target:i.target,manifest:i.manifest,stagger:!0};i.urlRoot&&(a.urlRoot=i.urlRoot),i.targetSuffix&&(a.targetSuffix=i.targetSuffix),n=new r(a,{id:i.id}),i.decouple||(t.Catalog[i.target][e]=n)}else t.Catalog[i.target][e]&&(n=t.Catalog[i.target][e])}else{const e=i.direct?"Compendium":"Catalog";if(t[e][i.target]||(t[e][i.target]={}),i.decouple||!t[e][i.target].collection){const r={target:i.target,direct:!!i.direct};i.urlRoot&&(r.urlRoot=i.urlRoot),i.targetSuffix&&(r.targetSuffix=i.targetSuffix),n=new a(r),i.decouple||(t[e][i.target].collection=n)}else t[e][i.target].collection&&(n=t[e][i.target].collection)}i.api&&n.meta.set("api",e.isJSON(i.api)?JSON.parse(i.api):i.api),n.stagger&&"function"==typeof n.initialize&&n.initialize()}return"object"==typeof n&&null!==n&&(void 0!==o&&(o.data=n,n instanceof r?o.model=n:n instanceof a&&(o.collection=n)),n.pending||n.completed||n.fetch()),n}},new t.Prototypes.AngularRegistry}])}]});