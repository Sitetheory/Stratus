!function(t,e){"function"==typeof define&&define.amd?define(["exports","stratus","lodash","angular","stratus.services.collection","stratus.services.model"],e):e(t.exports,t.Stratus,t._,t.angular,t.Collection,t.Model)}(this,function(t,e,a,o,r,i){let n=function(){console.error("$$interpolate not loaded:",arguments)};class c{constructor(){this.fetch=this.fetch.bind(this)}fetch(t,o){return new Promise(function(r,i){"string"==typeof t&&(t={target:t});const l={target:t.attr?t.attr("data-target"):t.target,targetSuffix:t.attr?t.attr("data-target-suffix"):t.targetSuffix,id:t.attr?t.attr("data-id"):t.id,manifest:t.attr?t.attr("data-manifest"):t.manifest,decouple:t.attr?t.attr("data-decouple"):t.decouple,direct:t.attr?t.attr("data-direct"):t.direct,api:t.attr?t.attr("data-api"):t.api,urlRoot:t.attr?t.attr("data-url-root"):t.urlRoot};let u=0;const f=function(){a.isNumber(u)&&u===a.size(l)&&r(c.build(l,o))};a.each(l,function(t,r){if(!t||"string"!=typeof t)return u++,void f();const i=n(t,!1,null,!0),c=i(o.$parent);if(void 0!==c)return l[r]=c,u++,void f();e.Environment.get("production")||console.log("poll attribute:",r),a.poll(function(){return i(o.$parent)},7500,250).then(function(t){e.Environment.get("production")||console.log("interpreted:",t),void 0!==t&&(l[r]=t,u++,f())}).catch(function(t){console.error(t)})})})}static build(t,o){let n;if(t.target){if(t.target=a.ucfirst(t.target),t.manifest||t.id){e.Catalog[t.target]||(e.Catalog[t.target]={});const a=t.id||"manifest";if(t.decouple||!e.Catalog[t.target][a]){const o={target:t.target,manifest:t.manifest,stagger:!0};t.urlRoot&&(o.urlRoot=t.urlRoot),t.targetSuffix&&(o.targetSuffix=t.targetSuffix),n=new i(o,{id:t.id}),t.decouple||(e.Catalog[t.target][a]=n)}else e.Catalog[t.target][a]&&(n=e.Catalog[t.target][a])}else{const a=t.direct?"Compendium":"Catalog";if(e[a][t.target]||(e[a][t.target]={}),t.decouple||!e[a][t.target].collection){const o={target:t.target,direct:!!t.direct};t.urlRoot&&(o.urlRoot=t.urlRoot),t.targetSuffix&&(o.targetSuffix=t.targetSuffix),n=new r(o),t.decouple||(e[a][t.target].collection=n)}else e[a][t.target].collection&&(n=e[a][t.target].collection)}t.api&&n.meta.set("api",a.isJSON(t.api)?JSON.parse(t.api):t.api),n.stagger&&"function"==typeof n.initialize&&n.initialize()}return"object"==typeof n&&null!==n&&(void 0!==o&&(o.data=n,n instanceof i?(o.model=n,"function"==typeof o.$applyAsync&&o.model.on("change",function(){o.$applyAsync()})):n instanceof r&&(o.collection=n)),n.pending||n.completed||n.fetch()),n}}return e.Services.Registry=["$provide",function(t){t.factory("Registry",["$interpolate","Collection","Model",function(t,e,a){return n=t,new c}])}],e.Data.Registry=c,c,c});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL3JlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIlN0cmF0dXMiLCJfIiwiYW5ndWxhciIsIkNvbGxlY3Rpb24iLCJNb2RlbCIsInRoaXMiLCIkJGludGVycG9sYXRlIiwiY29uc29sZSIsImVycm9yIiwiYXJndW1lbnRzIiwiUmVnaXN0cnkiLCJbb2JqZWN0IE9iamVjdF0iLCJmZXRjaCIsImJpbmQiLCIkZWxlbWVudCIsIiRzY29wZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwidGFyZ2V0Iiwib3B0aW9ucyIsImF0dHIiLCJ0YXJnZXRTdWZmaXgiLCJpZCIsIm1hbmlmZXN0IiwiZGVjb3VwbGUiLCJkaXJlY3QiLCJhcGkiLCJ1cmxSb290IiwiY29tcGxldGVkIiwidmVyaWZ5IiwiaXNOdW1iZXIiLCJzaXplIiwiYnVpbGQiLCJlYWNoIiwiZWxlbWVudCIsImtleSIsImludGVycHJldGVyIiwiaW5pdGlhbCIsIiRwYXJlbnQiLCJFbnZpcm9ubWVudCIsImdldCIsImxvZyIsInBvbGwiLCJ0aGVuIiwidmFsdWUiLCJjYXRjaCIsIm1lc3NhZ2UiLCJkYXRhIiwidWNmaXJzdCIsIkNhdGFsb2ciLCJtb2RlbE9wdGlvbnMiLCJzdGFnZ2VyIiwicmVnaXN0cnkiLCJjb2xsZWN0aW9uIiwiY29sbGVjdGlvbk9wdGlvbnMiLCJtZXRhIiwic2V0IiwiaXNKU09OIiwiSlNPTiIsInBhcnNlIiwiaW5pdGlhbGl6ZSIsIm1vZGVsIiwiJGFwcGx5QXN5bmMiLCJvbiIsInBlbmRpbmciLCJTZXJ2aWNlcyIsIiRwcm92aWRlIiwiJGludGVycG9sYXRlIiwiRGF0YSJdLCJtYXBwaW5ncyI6IkNBS0EsU0FBV0EsRUFBTUMsR0FDTyxtQkFBWEMsUUFBeUJBLE9BQU9DLElBQ3pDRCxPQUFPLENBQUMsVUFBVyxVQUFXLFNBQVUsVUFBVyw4QkFBK0IsMEJBQTJCRCxHQUU3R0EsRUFBUUQs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QUFRRCxRQUFRSSxHQUFNeUIsUUFFL0JoRCxFQUFRa0QsUUFBUTlCLEVBQVFELFFBQVFJLEtBQ3pDeUIsRUFBT2hELEVBQVFrRCxRQUFROUIsRUFBUUQsUUFBUUksUUFFcEMsQ0FDTCxNQUFNOEIsRUFBWWpDLEVBQVFNLE9BQXFCLGFBQVosVUFNbkMsR0FKSzFCLEVBQVFxRCxHQUFVakMsRUFBUUQsVUFDN0JuQixFQUFRcUQsR0FBVWpDLEVBQVFELFFBQVUsSUFHbENDLEVBQVFLLFdBQWF6QixFQUFRcUQsR0FBVWpDLEVBQVFELFFBQVFtQyxXQUFZLENBQ3JFLE1BQU1DLEVBQW9CLENBQ3hCcEMsT0FBUUMsRUFBUUQsT0FDaEJPLFNBQVVOLEVBQVFNLFFBR2hCTixFQUFRUSxVQUNWMkIsRUFBa0IzQixRQUFVUixFQUFRUSxTQUdsQ1IsRUFBUUUsZUFDVmlDLEVBQWtCakMsYUFBZUYsRUFBUUUsY0FHM0MwQixFQUFPLElBQUk3QyxFQUFXb0QsR0FFakJuQyxFQUFRSyxXQUNYekIsRUFBUXFELEdBQVVqQyxFQUFRRCxRQUFRbUMsV0FBYU4sUUFFeENoRCxFQUFRcUQsR0FBVWpDLEVBQVFELFFBQVFtQyxhQUMzQ04sRUFBT2hELEVBQVFxRCxHQUFVakMsRUFBUUQsUUFBUW1DLFlBS3pDbEMsRUFBUU8sS0FDVnFCLEVBQUtRLEtBQUtDLElBQUksTUFBT3hELEVBQUV5RCxPQUFPdEMsRUFBUU8sS0FBT2dDLEtBQUtDLE1BQU14QyxFQUFRTyxLQUFPUCxFQUFRTyxLQUk3RXFCLEVBQUtJLFNBQXNDLG1CQUFwQkosRUFBS2EsWUFDOUJiLEVBQUthLGFBNEJULE1BdkJvQixpQkFBVGIsR0FBOEIsT0FBVEEsU0FDUixJQUFYakMsSUFDVEEsRUFBT2lDLEtBQU9BLEVBRVZBLGFBQWdCNUMsR0FDbEJXLEVBQU8rQyxNQUFRZCxFQUVtQixtQkFBdkJqQyxFQUFPZ0QsYUFDaEJoRCxFQUFPK0MsTUFBTUUsR0FBRyxTQUFVLFdBRXhCakQsRUFBT2dELGlCQUdGZixhQUFnQjdDLElBQ3pCWSxFQUFPdUMsV0FBYU4sSUFJbkJBLEVBQUtpQixTQUFZakIsRUFBS25CLFdBQ3pCbUIsRUFBS3BDLFNBSUZvQyxHQWNYLE9BUkFoRCxFQUFRa0UsU0FBU3hELFNBQVcsQ0FBQyxXQUFZLFNBQVV5RCxHQUNqREEsRUFBU3ZFLFFBQVEsV0FBWSxDQUFDLGVBQWdCLGFBQWMsUUFBUyxTQUFVd0UsRUFBY2pFLEVBQVlDLEdBRXZHLE9BREFFLEVBQWdCOEQsRUFDVCxJQUFJMUQsT0FHZlYsRUFBUXFFLEtBQUszRCxTQUFXQSxFQUNkQSxFQUNIQSIsImZpbGUiOiJzZXJ2aWNlcy9yZWdpc3RyeS5qcyJ9