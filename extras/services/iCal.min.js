!function(t,e){"function"==typeof define&&define.amd?define(["stratus","ical"],e):e(t.Stratus)}(this,function(t,e,n){t.Services.iCal=["$provide",function(t){t.factory("iCal",[function(){const t=function(t,e){e=e||{},this.maxIterations=null!=e.maxIterations?e.maxIterations:1e3,this.skipInvalidDates=null!=e.skipInvalidDates&&e.skipInvalidDates,this.jCalData=ICAL.parse(t),this.component=new ICAL.Component(this.jCalData),this.events=this.component.getAllSubcomponents("vevent").map(t=>new ICAL.Event(t)),this.skipInvalidDates&&(this.events=this.events.filter(t=>{try{return t.startDate.toJSDate(),t.endDate.toJSDate(),!0}catch(t){return!1}}))};return t.prototype.between=function(t,e){const n=function(n,r){return(!t||r>=t.getTime())&&(!e||n<=e.getTime())},r=function(t){const e=t.startDate.toJSDate().getTime();let n=t.endDate.toJSDate().getTime();return t.endDate.isDate&&n>e&&(n-=1),{startTime:e,endTime:n}},a=[];this.events.forEach(t=>{t.isRecurrenceException()&&a.push(t)});const i={events:[],occurrences:[]};return this.events.filter(t=>!t.isRecurrenceException()).forEach(t=>{const o=[];if(t.component.getAllProperties("exdate").forEach(t=>{const e=t.getFirstValue();o.push(e.toJSDate().getTime())}),t.isRecurring()){const s=t.iterator();let c,u=0;do{if(u+=1,c=s.next()){const s=t.getOccurrenceDetails(c),{startTime:u,endTime:l}=r(s),m=-1!==o.indexOf(u),p=a.find(e=>e.uid===t.uid&&e.recurrenceId.toJSDate().getTime()===s.startDate.toJSDate().getTime());if(e&&u>e.getTime())break;n(u,l)&&(p?i.events.push(p):m||i.occurrences.push(s))}}while(c&&(!this.maxIterations||u<this.maxIterations));return}const{startTime:s,endTime:c}=r(t);n(s,c)&&i.events.push(t)}),i},t.prototype.before=function(t){return this.between(void 0,t)},t.prototype.after=function(t){return this.between(t)},t.prototype.all=function(){return this.between()},t.prototype.flattenRecurringEvent=function(t){const e=this.flattenEvent(t.item);return e.recurrenceId=t.recurrenceId.toJSDate(),e.startDate=t.startDate.toJSDate(),e.endDate=t.endDate.toJSDate(),e},t.prototype.flattenEvent=function(t){return{startDate:t.startDate.toJSDate(),endDate:t.endDate.toJSDate(),description:t.description,title:t.summary,summary:t.summary,attendees:t.attendees,organizer:t.organizer,sequence:t.sequence,uid:t.uid,location:t.location,url:t.url,allDay:t.allDay,image:t.image}},t.prototype.jsonEvents=function(t,e){let n;const r=(n=t&&e?this.between(t,e):this.all()).events.map(t=>this.flattenEvent(t)),a=n.occurrences.map(t=>this.flattenRecurringEvent(t));return[].concat(r,a)},t.prototype.flattenRecurringEventForFullCalendar=function(t){const e=this.flattenEventForFullCalendar(t.item);return e.start=t.startDate.toJSDate(),e.end=t.endDate.toJSDate(),e},t.prototype.flattenEventForFullCalendar=function(t){return{start:t.startDate.toJSDate(),end:t.endDate.toJSDate(),title:t.summary,summary:t.summary,description:t.description,attendees:t.attendees,organizer:t.organizer,id:t.uid,location:t.location,url:t.url,allDay:t.allDay,image:t.image}},t.prototype.jsonEventsForFullCalendar=function(t,e){let n;const r=(n=t&&e?this.between(t,e):this.all()).events.map(t=>this.flattenEventForFullCalendar(t)),a=n.occurrences.map(t=>this.flattenRecurringEventForFullCalendar(t));return[].concat(r,a)},{ICalExpander:t,registerTimezones:function(t){Object.keys(t).forEach(e=>{const n=t[e],r=ICAL.parse(`BEGIN:VCALENDAR\nPRODID:-//tzurl.org//NONSGML Olson 2012h//EN\nVERSION:2.0\n${n}\nEND:VCALENDAR`),a=new ICAL.Component(r).getFirstSubcomponent("vtimezone");ICAL.TimezoneService.register(a)})}}}])}]});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dHJhcy9zZXJ2aWNlcy9pQ2FsLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiU3RyYXR1cyIsInRoaXMiLCJfIiwiYW5ndWxhciIsIlNlcnZpY2VzIiwiaUNhbCIsIiRwcm92aWRlIiwiSUNhbEV4cGFuZGVyIiwiaWNzRGF0YSIsIm9wdHMiLCJtYXhJdGVyYXRpb25zIiwic2tpcEludmFsaWREYXRlcyIsImpDYWxEYXRhIiwiSUNBTCIsInBhcnNlIiwiY29tcG9uZW50IiwiQ29tcG9uZW50IiwiZXZlbnRzIiwiZ2V0QWxsU3ViY29tcG9uZW50cyIsIm1hcCIsInZldmVudCIsIkV2ZW50IiwiZmlsdGVyIiwiZXZ0Iiwic3RhcnREYXRlIiwidG9KU0RhdGUiLCJlbmREYXRlIiwiZXJyIiwicHJvdG90eXBlIiwiYmV0d2VlbiIsImFmdGVyIiwiYmVmb3JlIiwiaXNFdmVudFdpdGhpblJhbmdlIiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImdldFRpbWUiLCJnZXRUaW1lcyIsImV2ZW50T3JPY2N1cnJlbmNlIiwiaXNEYXRlIiwiZXhjZXB0aW9ucyIsImZvckVhY2giLCJldmVudCIsImlzUmVjdXJyZW5jZUV4Y2VwdGlvbiIsInB1c2giLCJyZXQiLCJvY2N1cnJlbmNlcyIsImUiLCJleERhdGVzIiwiZ2V0QWxsUHJvcGVydGllcyIsImV4RGF0ZVByb3AiLCJleERhdGUiLCJnZXRGaXJzdFZhbHVlIiwiaXNSZWN1cnJpbmciLCJpdGVyYXRvciIsIm5leHQiLCJpIiwib2NjdXJyZW5jZSIsImdldE9jY3VycmVuY2VEZXRhaWxzIiwiaXNPY2N1cnJlbmNlRXhjbHVkZWQiLCJpbmRleE9mIiwiZXhjZXB0aW9uIiwiZmluZCIsImV4IiwidWlkIiwicmVjdXJyZW5jZUlkIiwidW5kZWZpbmVkIiwiYWxsIiwiZmxhdHRlblJlY3VycmluZ0V2ZW50IiwiZmxhdHRlbkV2ZW50IiwiaXRlbSIsImRlc2NyaXB0aW9uIiwidGl0bGUiLCJzdW1tYXJ5IiwiYXR0ZW5kZWVzIiwib3JnYW5pemVyIiwic2VxdWVuY2UiLCJsb2NhdGlvbiIsInVybCIsImFsbERheSIsImltYWdlIiwianNvbkV2ZW50cyIsInN0YXJ0UmFuZ2UiLCJlbmRSYW5nZSIsIm1hcHBlZEV2ZW50cyIsIm8iLCJtYXBwZWRPY2N1cnJlbmNlcyIsImNvbmNhdCIsImZsYXR0ZW5SZWN1cnJpbmdFdmVudEZvckZ1bGxDYWxlbmRhciIsImZsYXR0ZW5FdmVudEZvckZ1bGxDYWxlbmRhciIsInN0YXJ0IiwiZW5kIiwiaWQiLCJqc29uRXZlbnRzRm9yRnVsbENhbGVuZGFyIiwicmVnaXN0ZXJUaW1lem9uZXMiLCJ0ekRhdGEiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwicGFyc2VkIiwidlRpbWV6b25lIiwiZ2V0Rmlyc3RTdWJjb21wb25lbnQiLCJUaW1lem9uZVNlcnZpY2UiLCJyZWdpc3RlciJdLCJtYXBwaW5ncyI6IkNBS0EsU0FBV0EsRUFBTUMsR0FDTyxtQkFBWEMsUUFBeUJBLE9BQU9DLElBQ3pDRCxPQUFPLENBQUMsVUFBVyxRQUNoQkQsR0FFSEEsRUFBUUQsRUFBS0ksU0FMakIsQ0FPR0MsS0FBTSxTQUFVRCxFQUFTRSxFQUFHQyxHQUc3QkgsRUFBUUksU0FBU0MsS0FBTyxDQUFDLFdBQVksU0FBVUMsR0FDN0NBLEVBQVNULFFBQVEsT0FBUSxDQUFDLFdBZXhCLE1BQU1VLEVBQWUsU0FBVUMsRUFBU0MsR0FDdENBLEVBQU9BLEdBQVEsR0FDZlIsS0FBS1MsY0FBc0MsTUFBdEJELEVBQUtDLGNBQXdCRCxFQUFLQyxjQUFnQixJQUN2RVQsS0FBS1UsaUJBQTRDLE1BQXpCRixFQUFLRSxrQkFBMkJGLEVBQUtFLGlCQUM3RFYsS0FBS1csU0FBV0MsS0FBS0MsTUFBTU4sR0FDM0JQLEtBQUtjLFVBQVksSUFBSUYsS0FBS0csVUFBVWYsS0FBS1csVUFDekNYLEtBQUtnQixPQUFTaEIsS0FBS2MsVUFBVUcsb0JBQW9CLFVBQVVDLElBQUlDLEdBQVUsSUFBSVAsS0FBS1EsTUFBTUQs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