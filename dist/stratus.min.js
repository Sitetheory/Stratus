!function(root,factory){"function"==typeof define&&define.amd?define(["exports","lodash","jquery","bowser"],function(exports,_,jQuery,bowser){return root.Stratus=factory(exports,_,jQuery,bowser)}):root.Stratus=factory(root.exports,root._,root.jQuery,root.bowser)}(this,function(exports,_,jQuery,bowser){let Stratus={Settings:{image:{size:{xs:200,s:400,m:600,l:800,xl:1200,hq:1600}},status:{reset:-2,deleted:-1,inactive:0,active:1},consent:{reject:-1,pending:0,accept:1}},DOM:{},Key:{},PostMessage:{},LocalStorage:{},Selector:{},Select:null,BaseUrl:(boot&&_.has(boot,"configuration")?boot.configuration.baseUrl:null)||"/",BundlePath:(boot&&_.has(boot,"configuration")?boot.configuration.bundlePath:"")||"",Events:null,Apps:{},Catalog:{},Compendium:{},Components:{},Controllers:{},Directives:{},Filters:{},Modules:{ngMaterial:!0,ngMessages:!0},Services:{},Client:bowser,CSS:{},Chronos:null,Data:{},Environment:{ip:null,production:!("string"==typeof document.cookie&&-1!==document.cookie.indexOf("env=")),context:null,contextId:null,contextMasterSiteId:null,siteId:null,masterSiteId:null,language:navigator.language,timezone:null,trackLocation:0,trackLocationConsent:0,lat:null,lng:null,postalCode:null,city:null,region:null,country:null,debugNest:!1,liveEdit:!1,viewPortChange:!1,viewPort:null,lastScroll:!1},History:{},Instances:{},Internals:{},Loaders:{},Prototypes:{},Resources:{},Roster:{controller:{selector:"[ng-controller]",namespace:"stratus.controllers."},components:{namespace:"stratus.components."},directives:{namespace:"stratus.directives.",type:"attribute"},flex:{selector:"[flex]",require:["angular","angular-material"]},chart:{selector:"[chart]",require:["angular","angular-chart"],module:!0,suffix:".js"},modules:{selector:["[ng-sanitize]","[froala]"],namespace:"angular-",module:!0},countUp:{selector:["[count-up]","[scroll-spy]"],namespace:"angular-",module:!0,suffix:"Module"},uiTree:{selector:"[ui-tree]",require:["angular-ui-tree"],module:"ui.tree"}},RegisterGroup:{},Api:{GoogleMaps:"AIzaSyBatGvzPR7u7NZ3tsCy93xj4gEBfytffyA",Froala:"KybxhzguB-7j1jC3A-16y=="}};Stratus.Environment.production||console.group("Stratus Warm Up"),_.templateSettings={evaluate:/\{%(.+?)%\}/g,interpolate:/\{\{(.+?)\}\}/g,escape:/\{#(.+?)#\}/g},_.mixin({any:_.some,all:_.every,compose:_.flowRight,contains:_.includes,findWhere:_.find,indexBy:_.keyBy,mapObject:_.mapValues,object:_.zipObject,omit:_.omitBy,pairs:_.toPairs,pluck:_.map,where:_.filter,functionName:function(code){return _.isEmpty(code)?null:(_.isString(code)||(code=code.toString()),(code=code.substr("function ".length)).substr(0,code.indexOf("(")))},ucfirst:function(string){return"string"==typeof string&&string?string.charAt(0).toUpperCase()+string.substring(1):null},lcfirst:function(string){return"string"==typeof string&&string?string.charAt(0).toLowerCase()+string.substring(1):null},cookie:function(name,value,expires,path,domain){const request={name:name,value:value,expires:expires,path:path||"/",domain:domain};if(name&&"object"==typeof name&&_.extend(request,name),void 0===request.value){const data=new RegExp("(?:^"+request.name+"|;\\s*"+request.name+")=(.*?)(?:;|$)","g").exec(document.cookie);return null===data?null:data[1]}{let cookie=request.name+"="+escape(request.value)+";";request.expires&&(request.expires instanceof Date?isNaN(request.expires.getTime())&&(request.expires=new Date):request.expires=new Date((new Date).getTime()+1e3*_.seconds(request.expires)),cookie+="expires="+request.expires.toUTCString()+";"),request.path&&(cookie+="path="+request.path+";"),request.domain&&(cookie+="domain="+request.domain+";"),document.cookie=cookie}},converge:function(list,method){if("string"!=typeof method&&(method="min"),"min"===method){const lowest=_.min(list);return _.findKey(list,function(element){return element===lowest})}if("radial"===method);else if("gauss"!==method)return list},repeat:function(fn,times){if("function"==typeof fn&&"number"==typeof times){let i;for(i=0;i<times;i++)fn()}else console.warn("Underscore cannot repeat function:",fn,"with number of times:",times)},dehydrate:function(value){return"string"==typeof value?value:JSON.stringify(value)},hydrate:function(string){return _.isJSON(string)?JSON.parse(string):string},hydrateString:function(string){return _.hydrate(string)},cloneDeep:function(obj){if("object"!=typeof obj)return obj;const shallow=_.clone(obj);return _.each(shallow,function(value,key){shallow[key]=_.cloneDeep(value)}),shallow},extendDeep:function(target,merger){let shallow=_.clone(target);return merger&&"object"==typeof merger?_.each(merger,function(value,key){shallow&&"object"==typeof shallow&&(shallow[key]=key in shallow?_.extendDeep(shallow[key],merger[key]):merger[key])}):shallow=merger,shallow},getAnchorParams:function(key,url){const vars={},tail=window.location.hash;if(_.isEmpty(tail))return vars;const digest=/([a-zA-Z]+)(?:\/([0-9]+))?/g;let match;for(;match=digest.exec(tail);)vars[match[1]]=_.hydrate(match[2]);return void 0!==key&&key?vars[key]:vars},getUrlParams:function(key,url){const vars={};void 0===url&&(url=window.location.href);const anchor=url.indexOf("#");return anchor>=0&&(url=url.substring(0,anchor)),url.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=_.hydrate(value)}),void 0!==key&&key?vars[key]:vars},setUrlParams:function(params,url){if(void 0===url&&(url=window.location.href),void 0===params)return url;let vars={};const glue=url.indexOf("?"),anchor=url.indexOf("#");let tail="";return anchor>=0&&(tail=url.substring(anchor,url.length),url=url.substring(0,anchor)),url.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value}),vars=_.extend(vars,params),(glue>=0?url.substring(0,glue):url)+"?"+_.map(vars,function(value,key){return key+"="+_.dehydrate(value)}).reduce(function(memo,value){return memo+"&"+value})+tail},allTrue:function(values){return"object"==typeof values&&_.every(values,function(value){return value})},isJSON:function(str){try{JSON.parse(str)}catch(e){return!1}return!0},isAngular:function(element){return"object"==typeof angular&&angular&&angular.element&&element instanceof angular.element},isjQuery:function(element){return"function"==typeof jQuery&&element instanceof jQuery},seconds:function(str){let seconds=0;if("string"==typeof str){const timePairs=str.match(/([\d+.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/gi);if(_.size(timePairs)){const digest=/([\d+.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/i;let time,unit,value;_.each(timePairs,function(timePair){if(time=digest.exec(timePair),value=parseFloat(time[1]),unit=time[2],!isNaN(value)){switch(time[2]){case"s":unit=1;break;case"m":unit=60;break;case"h":unit=3600;break;case"d":unit=86400;break;case"w":unit=604800;break;case"y":unit=31558149.504;break;default:unit=0}seconds+=value*unit}},this)}else seconds=null}else seconds="number"==typeof str?str:null;return seconds},camelToKebab:function(target){return target.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},kebabToCamel:function(target){return target.replace(/(-\w)/g,function(m){return m[1].toUpperCase()})},camelToSnake:function(target){return target.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()},snakeToCamel:function(target){return target.replace(/(_\w)/g,function(m){return m[1].toUpperCase()})},startsWith:function(target,search){return"string"==typeof target&&"string"==typeof search&&target.substr(0,search.length).toLowerCase()===search.toLowerCase()},endsWith:function(target,search){return"string"==typeof target&&"string"==typeof search&&target.substr(target.length-search.length,target.length).toLowerCase()===search.toLowerCase()},patch:function(newData,priorData){if(!_.isObject(newData)||!_.size(newData))return null;const patch={},processor={eax:void 0,ebx:void 0,ecx:void 0,edx:void 0};if(_.isObject(priorData)&&_.size(priorData)){const detect=function(value,key){processor.eax=processor.ecx?processor.ecx+"."+key:key,_.isObject(value)?(processor.ecx=processor.eax,_.each(value,detect),processor.ecx=processor.ecx===key?void 0:processor.ecx.substring(0,processor.ecx.lastIndexOf("."))):(processor.ebx=_.reduce(processor.eax.split("."),function(data,a){return data&&data[a]},priorData),processor.ebx!==value&&(processor.edx=value)),void 0!==processor.edx&&(patch[processor.eax]=value,processor.edx=void 0)};_.each(newData,detect)}else console.error("bad prior:",priorData);return patch&&_.size(patch)?patch:null},poll:function(fn,timeout,interval){timeout=timeout||2e3,interval=interval||100;const threshold=Number(new Date)+timeout,check=function(resolve,reject){const cond=fn();cond?resolve(cond):Number(new Date)<threshold?setTimeout(check,interval,resolve,reject):reject(new Error("Timeout "+fn+": "+arguments))};return new Promise(check)},strcmp:function(a,b){if(!a)return 1;if(!b)return-1;let i,n;for(a=a.toString(),b=b.toString(),i=0,n=Math.max(a.length,b.length);i<n&&a.charAt(i)===b.charAt(i);++i);return i===n?0:a.charAt(i)>b.charAt(i)?-1:1},truncate:function(target,limit,suffix){limit=limit||100,suffix=suffix||"...";const arr=target.replace(/</g,"\n<").replace(/>/g,">\n").replace(/\n\n/g,"\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n");let row,cut,add,tagMatch,tagName,sum=0;const tagStack=[];for(let i=0;i<arr.length;i++){const rowCut=(row=arr[i]).replace(/[ ]+/g," ");if(row.length){if("<"!==row[0])if(sum>=limit)row="";else if(sum+rowCut.length>=limit){if(" "===row[(cut=limit-sum)-1])for(;cut&&" "===row[(cut-=1)-1];);else-1!==(add=row.substring(cut).split("").indexOf(" "))?cut+=add:cut=row.length;row=row.substring(0,cut)+suffix,sum=limit}else sum+=rowCut.length;else if(sum>=limit)if(tagName=(tagMatch=row.match(/[a-zA-Z]+/))?tagMatch[0]:"")if("</"!==row.substring(0,2))tagStack.push(tagName),row="";else{for(;tagStack[tagStack.length-1]!==tagName&&tagStack.length;)tagStack.pop();tagStack.length&&(row=""),tagStack.pop()}else row="";arr[i]=row}}return arr.join("\n").replace(/\n/g,"")}}),Stratus.Select=function(selector,context){context||(context=document);let selection=selector;if("string"==typeof selector){let target;selection=context[target=_.startsWith(selector,".")||_.contains(selector,"[")?"querySelectorAll":_.contains(["html","head","body"],selector)||_.startsWith(selector,"#")?"querySelector":"querySelectorAll"](selector)}return selection&&"object"==typeof selection&&((_.isAngular(selection)||_.isjQuery(selection))&&(selection=selection.length?_.first(selection):{}),selection=_.extend({},Stratus.Selector,{context:this,length:_.size(selection),selection:selection,selector:selector})),selection},(Stratus=_.extend(function(selector,context){return Stratus.Select(selector,context)},Stratus)).Selector.attr=function(attr,value){const that=this;return that.selection instanceof window.NodeList?(console.warn('Unable to find "'+attr+'" for list:',that.selection),null):attr?void 0===value?(value=that.selection.getAttribute(attr),_.hydrate(value)):(that.selection.setAttribute(attr,_.dehydrate(value)),that):this},Stratus.Selector.addEventListener=function(type,listener,options){const that=this;if(!that.selection)return console.warn("Unable to add EventListener on empty selection."),that;const listen=node=>node.addEventListener(type,listener,options);return that.selection instanceof window.NodeList?(_.each(that.selection,listen),that):that.selection instanceof EventTarget?(listen(that.selection),that):(console.warn("Unabled to add EventListener on:",that.selection),that)},Stratus.Selector.each=function(callable){const that=this;return"function"!=typeof callable&&(callable=function(element){console.warn("each running on element:",element)}),that.selection instanceof window.NodeList&&_.each(that.selection,callable),that},Stratus.Selector.find=function(selector){const that=this;if(that.selection instanceof window.NodeList)console.warn('Unable to find "'+selector+'" for list:',that.selection);else if(selector)return Stratus(selector,that.selection);return null},Stratus.Selector.map=function(callable){const that=this;return"function"!=typeof callable&&(callable=function(element){console.warn("map running on element:",element)}),that.selection instanceof window.NodeList?_.map(that.selection,callable):that},Stratus.Selector.append=function(child){const that=this;return that.selection instanceof window.NodeList?console.warn("Unable to append child:",child,"to list:",that.selection):child&&that.selection.insertBefore(child,that.selection.lastChild),that},Stratus.Selector.prepend=function(child){const that=this;return that.selection instanceof window.NodeList?console.warn("Unable to prepend child:",child,"to list:",that.selection):child&&that.selection.insertBefore(child,that.selection.firstChild),that},Stratus.Selector.addClass=function(className){const that=this;return that.selection instanceof window.NodeList?console.warn('Unable to add class "'+className+'" to list:',that.selection):_.each(className.split(" "),function(name){that.selection.classList?that.selection.classList.add(name):that.selection.className+=" "+name}),that},Stratus.Selector.removeClass=function(className){const that=this;return that.selection instanceof window.NodeList?console.warn('Unable to remove class "'+className+'" from list:',that.selection):that.selection.classList?_.each(className.split(" "),function(name){that.selection.classList.remove(name)}):that.selection.className=that.selection.className.replace(new RegExp("(^|\\b)"+className.split(" ").join("|")+"(\\b|$)","gi")," "),that},Stratus.Selector.style=function(){const that=this;if(that.selection instanceof window.NodeList)console.warn("Unable to find style for list:",that.selection);else if(that.selection instanceof window.Node)return window.getComputedStyle(that.selection);return null},Stratus.Selector.height=function(){const that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find height for list:",that.selection),null):that.selection.offsetHeight||0},Stratus.Selector.width=function(){const that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find width for list:",that.selection),null):that.selection.offsetWidth||0},Stratus.Selector.offset=function(){const that=this;if(that.selection instanceof window.NodeList)console.warn("Unable to find offset for list:",that.selection);else if(that.selection.getBoundingClientRect){const rect=that.selection.getBoundingClientRect();return{top:rect.top+document.body.scrollTop,left:rect.left+document.body.scrollLeft}}return{top:null,left:null}},Stratus.Selector.parent=function(){const that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find offset for list:",that.selection),null):Stratus(that.selection.parentNode)},Stratus.Prototypes.EventManager=class{constructor(throttle){this.name="EventManager",this.listeners={},this.throttleTrigger=_.throttle(this.trigger,throttle||100)}off(name,callback,context){return console.log("off:",arguments),this}on(name,callback,context){const event=name instanceof Stratus.Prototypes.Event?name:new Stratus.Prototypes.Event({enabled:!0,hook:name,method:callback,scope:context||null});return(name=event.hook)in this.listeners||(this.listeners[name]=[]),this.listeners[name].push(event),this}once(name,callback,context){return this.on(name,function(event,...args){event.enabled=!1;const childArgs=_.clone(args);childArgs.unshift(event),callback.apply(event.scope||this,childArgs)},context),this}trigger(name,...args){return name in this.listeners?(this.listeners[name].forEach(function(event){if(!event.enabled)return;const childArgs=_.clone(args);childArgs.unshift(event),event.method.apply(event.scope||this,childArgs)}),this):this}},Stratus.Events=new Stratus.Prototypes.EventManager,Stratus.Prototypes.Error=class{constructor(error,chain){this.code="Internal",this.message="No discernible data received.",this.chain=[],"string"==typeof error?this.message=error:error&&"object"==typeof error&&_.extend(this,error),this.chain.push(chain)}},Stratus.Prototypes.Event=class{constructor(options){this.enabled=!1,this.hook=null,this.target=null,this.scope=null,this.debounce=null,this.throttle=null,this.method=function(){console.warn("No method:",this)},options&&"object"==typeof options&&_.extend(this,options),this.listening=!1,this.invalid=!1,"string"!=typeof this.hook&&(console.error("Unsupported hook:",this.hook),this.invalid=!0),void 0===this.target||null===this.target||this.target instanceof EventTarget||(console.error("Unsupported target:",this.target),this.invalid=!0),"function"!=typeof this.method&&(console.error("Unsupported method:",this.method),this.invalid=!0),this.invalid&&(this.enabled=!1)}},Stratus.Prototypes.Job=class{constructor(time,method,scope){this.enabled=!1,time&&"object"==typeof time?_.extend(this,time):(this.time=time,this.method=method,this.scope=scope),this.time=_.seconds(this.time),this.scope=this.scope||window}},Stratus.Prototypes.Model=class extends Stratus.Prototypes.EventManager{constructor(data,options){super(),this.name="Model",this.data={},this.temps={},this.changed=!1,this.watching=!1,this.patch={},data&&_.extend(this.data,data),this.toObject=this.toObject.bind(this),this.toJSON=this.toJSON.bind(this),this.each=this.each.bind(this),this.get=this.get.bind(this),this.has=this.has.bind(this),this.size=this.size.bind(this),this.set=this.set.bind(this),this.setAttribute=this.setAttribute.bind(this),this.temp=this.temp.bind(this),this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.iterate=this.iterate.bind(this),this.clear=this.clear.bind(this),this.clearTemp=this.clearTemp.bind(this)}toObject(options){return _.clone(this.data)}toJSON(options){return _.clone(this.data)}each(callback,scope){_.each.apply(void 0===scope?this:scope,_.union([this.data],arguments))}get(attr){return _.reduce("string"==typeof attr?attr.split("."):[],function(attrs,a){return attrs&&attrs[a]},this.data)}has(attr){return void 0!==this.get(attr)}size(){return _.size(this.data)}set(attr,value){if(attr&&"object"==typeof attr){const that=this;_.each(attr,function(value,attr){that.setAttribute(attr,value)},this)}else this.setAttribute(attr,value)}setAttribute(attr,value){if("string"==typeof attr)if(-1!==attr.indexOf(".")){let reference=this.data;const chain=attr.split(".");if(_.find(_.initial(chain),function(link){if(_.has(reference,link)&&reference[link]||(reference[link]={}),void 0===reference||!reference||"object"!=typeof reference)return reference=this.data,!0;reference=reference[link]},this),!_.isEqual(reference,this.data)){const link=_.last(chain);!reference||"object"!=typeof reference||_.has(reference,link)&&_.isEqual(reference[link],value)||(reference[link]=value,this.trigger("change:"+attr,this),this.trigger("change",this))}}else _.has(this.data,attr)&&_.isEqual(this.data[attr],value)||(this.data[attr]=value,this.trigger("change:"+attr,this),this.trigger("change",this))}temp(attr,value){this.set(attr,value),attr&&"object"==typeof attr?_.each(attr,function(value,attr){this.temps[attr]=value},this):this.temps[attr]=value}add(attr,value){if(this.has(attr)||this.set(attr,[]),void 0!==value&&!_.contains(this.data[attr],value))return this.data[attr].push(value),value}remove(attr,value){return void 0===value||(this.data[attr]=_.without(this.data[attr],value)),this.data[attr]}iterate(attr){return this.has(attr)||this.set(attr,0),++this.data[attr]}clear(){for(const attribute in this.data)Object.prototype.hasOwnProperty.call(this.data,attribute)&&delete this.data[attribute]}clearTemp(){for(const attribute in this.temps)Object.prototype.hasOwnProperty.call(this.temps,attribute)&&delete this.temps[attribute]}},Stratus.Collections=new Stratus.Prototypes.Model,Stratus.Models=new Stratus.Prototypes.Model,Stratus.Routers=new Stratus.Prototypes.Model,Stratus.Environment=new Stratus.Prototypes.Model(Stratus.Environment),Stratus.Prototypes.Sentinel=class{constructor(){this.view=!1,this.create=!1,this.edit=!1,this.delete=!1,this.publish=!1,this.design=!1,this.dev=!1,this.master=!1,this.zero=this.zero.bind(this),this.permissions=this.permissions.bind(this),this.summary=this.summary.bind(this)}zero(){_.extend(this,{view:!1,create:!1,edit:!1,delete:!1,publish:!1,design:!1,dev:!1,master:!1})}permissions(value){if(isNaN(value)){let decimal=0;return decimal+=this.view?1:0,decimal+=this.create?2:0,decimal+=this.edit?4:0,decimal+=this.delete?8:0,decimal+=this.publish?16:0,decimal+=this.design?32:0,decimal+=this.dev?64:0,decimal+=this.master?128:0}_.each(value.toString(2).split("").reverse(),function(bit,key){if("1"===bit)switch(key){case 0:this.view=!0;break;case 1:this.create=!0;break;case 2:this.edit=!0;break;case 3:this.delete=!0;break;case 4:this.publish=!0;break;case 5:this.design=!0;break;case 6:this.dev=!0;break;case 7:this.view=!0,this.create=!0,this.edit=!0,this.delete=!0,this.publish=!0,this.design=!0,this.dev=!0,this.master=!0}},this)}summary(){const output=[];return _.each(this,function(value,key){"boolean"==typeof value&&value&&output.push(_.ucfirst(key))}),output}},Stratus.Prototypes.Toast=class{constructor(message,title,priority,settings){message&&"object"==typeof message?(_.extend(this,message),this.message=this.message||"Message"):this.message=message||"Message",this.title=this.title||title||"Toast",this.priority=this.priority||priority||"danger",this.settings=this.settings||settings,this.settings&&"object"==typeof this.settings||(this.settings={}),this.settings.timeout=this.settings.timeout||1e4}},Stratus.Internals.XHR=function(request){this.method="GET",this.url="/Api",this.data={},this.type="",this.success=function(response){return response},this.error=function(response){return response},_.extend(this,request);const that=this;this.xhr=new window.XMLHttpRequest;const promise=new Promise(function(resolve,reject){that.xhr.open(that.method,that.url,!0),"string"==typeof that.type&&that.type.length&&that.xhr.setRequestHeader("Content-Type",that.type),that.xhr.onload=function(){if(that.xhr.status>=200&&that.xhr.status<400){let response=that.xhr.responseText;_.isJSON(response)&&(response=JSON.parse(response)),resolve(response)}else reject(that.xhr)},that.xhr.onerror=function(){reject(that.xhr)},Object.keys(that.data).length?that.xhr.send(JSON.stringify(that.data)):that.xhr.send()});return promise.then(that.success,that.error),promise},Stratus.Internals.Anchor=function Anchor(){Anchor.initialize=!0}(),Stratus.Internals.Api=function(route,meta,payload){return void 0===route&&(route="Default"),void 0!==meta&&null!==meta||(meta={}),void 0===payload&&(payload={}),"object"!=typeof meta&&(meta={method:meta}),_.has(meta,"method")||(meta.method="GET"),Stratus.Internals.Convoy({route:{controller:route},meta:meta,payload:payload})},Stratus.Internals.Compatibility=function(){const profile=[];Stratus.Client.android?profile.push("android"):Stratus.Client.ios?profile.push("ios"):Stratus.Client.mac?profile.push("mac"):Stratus.Client.windows?profile.push("windows"):Stratus.Client.linux?profile.push("linux"):profile.push("os"),Stratus.Client.chrome?profile.push("chrome"):Stratus.Client.firefox?profile.push("firefox"):Stratus.Client.safari?profile.push("safari"):Stratus.Client.opera?profile.push("opera"):Stratus.Client.msie?profile.push("msie"):Stratus.Client.iphone?profile.push("iphone"):profile.push("browser"),Stratus.Client.version&&profile.push("version"+Stratus.Client.version.split(".")[0]),Stratus.Client.mobile?profile.push("mobile"):Stratus.Client.tablet?profile.push("tablet"):profile.push("desktop"),Stratus("body").addClass(profile.join(" "))},Stratus.Internals.Convoy=function(convoy,query){return new Promise(function(resolve,reject){void 0===convoy&&reject(new Stratus.Prototypes.Error({code:"Convoy",message:"No Convoy defined for dispatch."},this)),"function"==typeof jQuery&&jQuery.ajax?jQuery.ajax({type:"POST",url:"/Api"+encodeURIComponent(query||""),data:{convoy:JSON.stringify(convoy)},dataType:_.has(convoy,"meta")&&_.has(convoy.meta,"dataType")?convoy.meta.dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},success:function(response){return resolve(response),response},error:function(response){return reject(new Stratus.Prototypes.Error({code:"Convoy",message:response},this)),response}}):Stratus.Internals.XHR({method:"POST",url:"/Api"+encodeURIComponent(query||""),data:{convoy:JSON.stringify(convoy)},type:_.has(convoy,"meta")&&_.has(convoy.meta,"dataType")?convoy.meta.dataType:"application/json",success:function(response){return response=response.payload||response,resolve(response),response},error:function(response){return reject(new Stratus.Prototypes.Error({code:"Convoy",message:response},this)),response}})})},Stratus.Internals.CssLoader=function(url){return new Promise(function(resolve,reject){if(url in Stratus.CSS)return void(Stratus.CSS[url]?resolve():Stratus.Events.once("onload:"+url,resolve));Stratus.CSS[url]=!1;const link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url,Stratus.Events.once("onload:"+url,function(){Stratus.CSS[url]=!0,resolve()}),"onload"in link&&!Stratus.Client.android?link.onload=function(){Stratus.Events.trigger("onload:"+url)}:(Stratus.CSS[url]=!0,Stratus.Events.trigger("onload:"+url)),Stratus("head").append(link)})},Stratus.Internals.GetColWidth=function(el){if(void 0===el||!el)return!1;const classes=el.attr("class");if(void 0===classes||!classes)return!1;const match=/col-.{2}-([0-9]*)/g.exec(classes);return!(void 0===match||!match)&&(void 0!==match[1]&&match[1])},Stratus.Internals.GetScrollDir=function(){const windowTop=jQuery(Stratus.Environment.get("viewPort")||window).scrollTop(),lastWindowTop=Stratus.Environment.get("windowTop");return!!lastWindowTop&&windowTop>lastWindowTop?"down":!!(!!lastWindowTop&&windowTop<lastWindowTop)&&"up"},Stratus.Internals.IsOnScreen=function(el,offset,partial){if(!el)return!1;if(el instanceof jQuery||(el=jQuery(el)),!el.length)return!1;offset=offset||0,"boolean"!=typeof partial&&(partial=!0);const viewPort=Stratus.Environment.get("viewPort")||window,$viewPort=jQuery(viewPort);let pageTop=$viewPort.scrollTop(),pageBottom=pageTop+$viewPort.height(),elementTop=el.offset().top;viewPort!==window&&(elementTop+=pageTop);const elementBottom=elementTop+el.height();return pageTop+=offset,pageBottom-=offset,partial?elementTop<=pageBottom&&elementBottom>=pageTop:pageTop<elementTop&&pageBottom>elementBottom},Stratus.Internals.LoadCss=function(urls){return new Promise(function(resolve,reject){void 0!==urls&&"function"!=typeof urls||reject(new Stratus.Prototypes.Error({code:"LoadCSS",message:"CSS Resource URLs must be defined as a String, Array, or Object."},this)),"string"==typeof urls&&(urls=[urls]);const cssEntries={total:urls.length,iteration:0};cssEntries.total>0?_.each(urls.reverse(),function(url){cssEntries.iteration++;const cssEntry=_.uniqueId("css_");cssEntries[cssEntry]=!1,void 0!==url&&url?Stratus.Internals.CssLoader(url).then(function(entry){cssEntries[cssEntry]=!0,cssEntries.total===cssEntries.iteration&&_.allTrue(cssEntries)&&resolve(cssEntries)},reject):(cssEntries[cssEntry]=!0,cssEntries.total===cssEntries.iteration&&_.allTrue(cssEntries)&&resolve(cssEntries))}):reject(new Stratus.Prototypes.Error({code:"LoadCSS",message:"No CSS Resource URLs found!"},this))})},Stratus.Internals.LoadEnvironment=function(){const initialLoad=Stratus("body").attr("data-environment");initialLoad&&"object"==typeof initialLoad&&_.size(initialLoad)&&Stratus.Environment.set(initialLoad);let passiveEventOptions=!1;try{Stratus.Select(Stratus.Environment.get("viewPort")||window).addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveEventOptions={passive:!0}}}))}catch(err){}Stratus.Environment.set("passiveEventOptions",passiveEventOptions)},Stratus.Internals.LoadImage=function(obj){if(!obj.el)return setTimeout(function(){Stratus.Internals.LoadImage(obj)},500),!1;const el=obj.el instanceof jQuery?obj.el:jQuery(obj.el);if(!el.length)return setTimeout(function(){Stratus.Internals.LoadImage(obj)},500),!1;el.hasClass("placeholder")||(el.addClass("placeholder"),el.on("load",function(){el.removeClass("placeholder")})),Stratus.Internals.IsOnScreen(obj.spy||el)&&!_.hydrate(el.attr("data-loading"))&&(el.attr("data-loading",_.dehydrate(!0)),Stratus.DOM.complete(function(){let hd=_.hydrate(el.attr("data-hd"));void 0===hd&&(hd=!0);let src=_.hydrate(el.attr("data-src"))||el.attr("src")||null;const type=el.prop("tagName").toLowerCase();if("img"!==type||"lazy"!==src&&!_.isEmpty(src)||(src=el.attr("src")),_.isEmpty(src))return!1;let size=_.hydrate(el.attr("data-size"))||obj.size||null;if(!size){let width=null,unit=null,percentage=null;if(el.width()?width=el.width():el.attr("width")&&(width=el.attr("width")),width){unit=(width=/([\d]+)(.*)/.exec(width))[2],width=parseInt(width[1]),percentage="%"===unit?width/100:null}if(!width||"%"===unit){const visibilitySelector=_.hydrate(el.attr("data-ignore-visibility"))?null:":visible",$visibleParent=jQuery(_.first(jQuery(obj.el).parents(visibilitySelector)));width=$visibleParent?$visibleParent.width():0;const $col=$visibleParent.find('[class*="col-"]');if($col.length>0){const colWidth=Stratus.Internals.GetColWidth($col);colWidth&&(width=Math.round(width/colWidth))}percentage&&(width=Math.round(width*percentage))}if(width<=0)return setTimeout(function(){el.attr("data-loading",_.dehydrate(!1)),Stratus.Internals.LoadImage(obj)},500),!1;hd&&(width*=2),"xs"===(size=(size=_.findKey(Stratus.Settings.image.size,function(s){const ratio=s/width;return ratio>.85&&ratio<1.15||s>width}))||"hq")&&setTimeout(function(){el.attr("data-loading",_.dehydrate(!1)),Stratus.Internals.LoadImage(obj)},1500)}const srcOrigin=src,srcMatch=/^(.+?)(-[A-Z]{2})?\.(?=[^.]*$)(.+)/gi.exec(src);null!==srcMatch?src=srcMatch[1]+"-"+size+"."+srcMatch[3]:console.error("Unable to find file name for image src:",el),el.addClass("loading");const srcOriginProtocol=srcOrigin.startsWith("//")?window.location.protocol+srcOrigin:srcOrigin;if("img"===type)el.on("load",function(){el.addClass("loaded").removeClass("loading")}),el.on("error",function(){el.attr("data-loading",_.dehydrate(!1)),el.attr("src",srcOriginProtocol),console.log("Unable to load",size.toUpperCase(),"size.","Restored:",el.attr("src"))});else{const loadEl=jQuery("<img/>");loadEl.attr("src",srcOriginProtocol),loadEl.on("load",function(){el.addClass("loaded").removeClass("loading"),jQuery(this).remove()}),loadEl.on("error",function(){el.attr("data-loading",_.dehydrate(!1)),el.css("background-image","url("+srcOriginProtocol+")"),console.log("Unable to load",size.toUpperCase(),"size.","Restored:",srcOriginProtocol)})}const srcProtocol=src.startsWith("//")?window.location.protocol+src:src;el.attr("data-loading",_.dehydrate(!1)),el.attr("data-size",_.dehydrate(size)),"img"===type?el.attr("src",srcProtocol):el.css("background-image","url("+srcProtocol+")"),Stratus.RegisterGroup.remove("OnScroll",obj)}))},Stratus.Internals.Location=function(options){return new Promise(function(resolve,reject){"geolocation"in navigator?(options=_.extend({enableHighAccuracy:!0,timeout:2e4,maximumAge:5e4},options||{}),navigator.geolocation.getCurrentPosition(resolve,reject,options)):reject(new Stratus.Prototypes.Error({code:"Location",message:"HTML5 Geo-Location isn't supported on this browser."},this))})},Stratus.Internals.OnScroll=_.once(function(elements){Stratus.Environment.on("change:viewPortChange",function(event,model){if(!model.get("viewPortChange"))return;model.set("lastScroll",Stratus.Internals.GetScrollDir());const elements=Stratus.RegisterGroup.get("OnScroll");_.each(elements,function(obj){void 0!==obj&&_.has(obj,"method")&&obj.method(obj)}),model.set("viewPortChange",!1),model.set("windowTop",jQuery(Stratus.Environment.get("viewPort")||window).scrollTop())});const viewPort=Stratus.Select(Stratus.Environment.get("viewPort")||window),viewPortChangeHandler=_.throttle(function(){Stratus.Environment.get("viewPortChange")||Stratus.Environment.set("viewPortChange",!0)},120);viewPort.addEventListener("scroll",viewPortChangeHandler,Stratus.Environment.get("passiveEventOptions")),viewPort.addEventListener("resize",viewPortChangeHandler,Stratus.Environment.get("passiveEventOptions")),Stratus.DOM.complete(function(){Stratus.Environment.set("viewPortChange",!0)})}),Stratus.Internals.Resource=function(path,elementId){return new Promise(function(resolve,reject){if(void 0===path&&reject(new Stratus.Prototypes.Error({code:"Resource",message:"Resource path is not defined."},this)),_.has(Stratus.Resources,path))Stratus.Resources[path].success?resolve(Stratus.Resources[path].data):Stratus.Events.once("resource:"+path,resolve);else{Stratus.Resources[path]={success:!1,data:null},Stratus.Events.once("resource:"+path,resolve);const meta={path:path,dataType:"text"};void 0!==elementId&&(meta.elementId=elementId),Stratus.Internals.Api("Resource",meta,{}).then(function(data){Stratus.Resources[path].success=!0,Stratus.Resources[path].data=data,Stratus.Events.trigger("resource:"+path,data)},reject)}})},Stratus.Internals.SetUrlParams=function(params,url){return _.setUrlParams(params,url)},Stratus.Internals.TrackLocation=function(){const envData={};envData.timezone=(new Date).toString().match(/\((.*)\)/)[1],Stratus.Environment.get("trackLocation")?Stratus.Environment.get("trackLocationConsent")?Stratus.Internals.Location().then(function(pos){envData.lat=pos.coords.latitude,envData.lng=pos.coords.longitude,Stratus.Environment.set("lat",pos.coords.latitude),Stratus.Environment.set("lng",pos.coords.longitude),Stratus.Internals.UpdateEnvironment(envData)},function(error){console.error("Stratus Location:",error)}):Stratus.Internals.XHR({url:"https://ipapi.co/"+Stratus.Environment.get("ip")+"/json/",success:function(data){data||(data={}),"object"==typeof data&&Object.keys(data).length&&data.postal&&(envData.postalCode=data.postal,envData.lat=data.latitude,envData.lng=data.longitude,envData.city=data.city,envData.region=data.region,envData.country=data.country,Stratus.Internals.UpdateEnvironment(envData))}}):Stratus.Internals.UpdateEnvironment(envData)},Stratus.Internals.UpdateEnvironment=function(request){if(request||(request={}),"string"!=typeof document.cookie||!_.cookie("SITETHEORY"))return!1;"object"==typeof request&&Object.keys(request).length&&Stratus.Internals.XHR({method:"PUT",url:"/Api/Session",data:request,type:"application/json",success:function(response){const settings=response.payload||response;"object"==typeof settings&&_.each(Object.keys(settings),function(key){Stratus.Environment.set(key,settings[key])})},error:function(error){console.error("error:",error)}})};const rendererData={webgl:null,debugInfo:null,vendor:null,renderer:null};Stratus.Internals.Renderer=function(brief){if(rendererData.webgl)return brief?rendererData.renderer:rendererData;const canvas=document.createElement("canvas");try{rendererData.webgl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}catch(e){}return rendererData.webgl?(rendererData.debugInfo=rendererData.webgl.getExtension("WEBGL_debug_renderer_info"),rendererData.vendor=rendererData.webgl.getParameter(rendererData.debugInfo.UNMASKED_VENDOR_WEBGL),rendererData.renderer=rendererData.webgl.getParameter(rendererData.debugInfo.UNMASKED_RENDERER_WEBGL),brief?rendererData.renderer:rendererData):brief?rendererData.renderer:rendererData},Stratus.Loaders.Angular=(()=>{let requirement,nodes,injection;const container={requirement:[],module:[],stylesheet:[]},injector=function(injection){injection=injection||{},_.each(injection,function(element,attribute){container[attribute]=container[attribute]||[],_.isArray(element)?_.each(element,function(value){container[attribute].push(value)}):container[attribute].push(element)})};_.each(Stratus.Roster,function(element,key){if("object"==typeof element&&element)if(_.isUndefined(element.selector)&&element.namespace&&(element.selector=_.filter(_.map(boot.configuration.paths,function(path,key){return _.startsWith(key,element.namespace)?("attribute"===element.type?"[":"")+_.camelToKebab(key.replace(element.namespace,"stratus-"))+("attribute"===element.type?"]":""):null}))),_.isArray(element.selector))element.length=0,_.each(element.selector,function(selector){if(nodes=document.querySelectorAll(selector),element.length+=nodes.length,nodes.length){const name=selector.replace(/^\[/,"").replace(/]$/,"");requirement=element.namespace+_.lcfirst(_.kebabToCamel(name.replace(/^stratus/,"").replace(/^ng/,""))),_.has(boot.configuration.paths,requirement)&&(injection={requirement:requirement},element.module&&(injection.module=_.isString(element.module)?element.module:_.lcfirst(_.kebabToCamel(name+(element.suffix||"")))),injector(injection))}});else if(_.isString(element.selector)&&(nodes=document.querySelectorAll(element.selector),element.length=nodes.length,nodes.length)){const attribute=element.selector.replace(/^\[/,"").replace(/]$/,"");attribute&&element.namespace?_.each(nodes,function(node){const name=node.getAttribute(attribute);name&&(requirement=element.namespace+_.lcfirst(_.kebabToCamel(name.replace("Stratus",""))),_.has(boot.configuration.paths,requirement)&&injector({requirement:requirement}))}):element.require&&(container.requirement=_.union(container.requirement,element.require),injection={},element.module&&(injection.module=_.isString(element.module)?element.module:_.lcfirst(_.kebabToCamel(attribute+(element.suffix||"")))),element.stylesheet&&(injection.stylesheet=element.stylesheet),injector(injection))}}),container.requirement.push("angular-material"),_.each(container,function(element,key){container[key]=_.uniq(element)}),window.container=container,container.requirement.length&&(Object.keys(boot.configuration.paths).filter(function(path){return _.startsWith(path,"stratus.filters.")}).forEach(function(requirement){container.requirement.push(requirement)}),require(container.requirement,function(){if(angular.module("stratusApp",_.union(Object.keys(Stratus.Modules),container.module)).config(["$sceDelegateProvider",function($sceDelegateProvider){const whitelist=["self","http://*.sitetheory.io/**","https://*.sitetheory.io/**"];boot.host&&(_.startsWith(boot.host,"//")?_.each(["https:","http:"],function(proto){whitelist.push(proto+boot.host+"/**")}):whitelist.push(boot.host+"/**")),$sceDelegateProvider.resourceUrlWhitelist(whitelist)}]),"function"==typeof jQuery&&jQuery.fn&&jQuery.FroalaEditor){jQuery.FroalaEditor.DEFAULTS.key=Stratus.Api.Froala;const buttons=["bold","italic","underline","strikeThrough","subscript","superscript","|","formatBlock","blockStyle","inlineStyle","paragraphStyle","paragraphFormat","align","formatOL","formatUL","outdent","indent","|","insertLink","insertImage","insertVideo","insertFile","insertTable","|","undo","redo","removeFormat","wordPaste","help","html","fullscreen"];angular.module("stratusApp").value("froalaConfig",{codeBeautifierOptions:{end_with_newline:!0,indent_inner_html:!0,extra_liners:"['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'ol', 'table', 'dl']",brace_style:"expand",indent_char:" ",indent_size:4,wrap_line_length:0},codeMirror:!0,codeMirrorOptions:{indentWithTabs:!1,lineNumbers:!0,lineWrapping:!0,mode:"text/html",tabMode:"space",tabSize:4},fileUploadURL:"https://app.sitetheory.io:3000/?session="+_.cookie("SITETHEORY"),htmlAllowedAttrs:[".*"],htmlAllowedEmptyTags:["textarea","a",".fa","iframe","object","video","style","script","div"],htmlAllowedTags:[".*"],htmlRemoveTags:[""],htmlUntouched:!0,imageManagerPageSize:20,imageManagerScrollOffset:10,imageManagerLoadURL:"/Api/Media?payload-only=true",imageManagerLoadMethod:"GET",imageManagerDeleteMethod:"DELETE",multiLine:!0,pasteDeniedAttrs:[""],pasteDeniedTags:[""],pastePlain:!1,toolbarSticky:!1,toolbarButtons:buttons,toolbarButtonsMD:buttons,toolbarButtonsSM:buttons,toolbarButtonsXS:buttons})}_.each(Stratus.Services,function(service){angular.module("stratusApp").config(service)}),_.each(Stratus.Components,function(component,name){angular.module("stratusApp").component("stratus"+_.ucfirst(name),component)}),_.each(Stratus.Directives,function(directive,name){angular.module("stratusApp").directive("stratus"+_.ucfirst(name),directive)}),_.each(Stratus.Filters,function(filter,name){angular.module("stratusApp").filter(_.lcfirst(name),filter)}),_.each(Stratus.Controllers,function(controller,name){angular.module("stratusApp").controller(name,controller)});const css=container.stylesheet,cssLoaded=Stratus("link[satisfies]").map(function(node){return node.getAttribute("satisfies")});if(!_.contains(cssLoaded,"angular-material.css")&&"angular-material"in boot.configuration.paths&&css.push(Stratus.BaseUrl+boot.configuration.paths["angular-material"].replace(/\.[^.]+$/,"")+(Stratus.Environment.get("production")?".min":"")+".css"),Stratus.Directives.Froala||Stratus("[froala]").length){const froalaPath=boot.configuration.paths.froala.replace(/\/[^/]+\/?[^/]+\/?$/,"");_.each([Stratus.BaseUrl+"sitetheorycore/css/sitetheory.codemirror.css",Stratus.BaseUrl+boot.configuration.paths.codemirror.replace(/\/([^/]+)\/?$/,"")+"/codemirror.css",Stratus.BaseUrl+froalaPath+"/css/froala_editor.min.css",Stratus.BaseUrl+froalaPath+"/css/froala_style.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/code_view.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/draggable.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/file.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/fullscreen.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/help.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/image.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/image_manager.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/quick_insert.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/special_characters.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/table.min.css",Stratus.BaseUrl+froalaPath+"/css/plugins/video.min.css"],stylesheet=>css.push(stylesheet))}if(css.length){let counter=0;css.forEach(function(url){Stratus.Internals.CssLoader(url).then(function(){++counter===css.length&&angular.bootstrap(document.querySelector("html"),["stratusApp"])})})}else angular.bootstrap(document.querySelector("html"),["stratusApp"])}))}),Stratus.Instances.Clean=function(instances){if(void 0===instances?console.error("Stratus.Instances.Clean() requires a string or array containing Unique ID(s)."):"string"==typeof instances&&(instances=[instances]),"object"!=typeof instances||!Array.isArray(instances))return!1;_.each(instances,function(value){_.has(Stratus.Instances,value)&&("function"==typeof Stratus.Instances[value].remove&&Stratus.Instances[value].remove(),delete Stratus.Instances[value])})};Stratus.Aether=new class extends Stratus.Prototypes.Model{constructor(data,options){super(data,options),this.passiveSupported=!1,Stratus.Environment.get("production")||console.info("Aether Invoked!");const that=this;try{const options={get passive(){that.passiveSupported=!0}};window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch(err){that.passiveSupported=!1}this.on("change",this.synchronize,this)}synchronize(){Stratus.Environment.get("production")||console.info("Aether Synchronizing..."),_.isEmpty(this.data)&&console.warn("synchronize: no data!"),_.each(this.data,function(event,key){!event.listening&&event.enabled&&(Stratus.Environment.get("viewPort")&&console.warn("Aether does not support custom viewPorts:",Stratus.Environment.get("viewPort")),(event.target||window).addEventListener(event.hook,event.method,!!this.passiveSupported&&{capture:!0,passive:!0}),event.listening=!0)},this)}listen(options){let uid=null;const event=new Stratus.Prototypes.Event(options);return event.invalid||(uid=_.uniqueId("event_"),this.set(uid,event),Stratus.Instances[uid]=event),uid}};return Stratus.Chronos=new class extends Stratus.Prototypes.Model{constructor(data,options){super(data,options),Stratus.Environment.get("production")||console.info("Chronos Invoked!"),this.on("change",this.synchronize,this)}synchronize(){Stratus.Environment.get("production")||console.info("Chronos Synchronizing..."),_.isEmpty(this.changed)&&console.warn("synchronize: empty changeset!"),_.each(this.changed,function(job,key){"string"==typeof key&&-1!==key.indexOf(".")&&(key=_.first(key.split(".")),job=this.get(key)),!job.code&&job.enabled?job.code=setInterval(function(job){job.method.call(job.scope)},1e3*job.time,job):job.code&&!job.enabled&&(clearInterval(job.code),job.code=0)},this)}queue(time,method,scope){const job=time instanceof Stratus.Prototypes.Job?time:new Stratus.Prototypes.Job(time,method,scope);if(null===job.time||"function"!=typeof job.method)return null;const uid=_.uniqueId("job_");return this.set(uid,job),Stratus.Instances[uid]=job,uid}enable(uid){return!!this.has(uid)&&(this.set(uid+".enabled",!0),!0)}disable(uid){return!!this.has(uid)&&(this.set(uid+".enabled",!1),!0)}toggle(uid,value){return!!this.has(uid)&&(this.set(uid+".enabled","boolean"==typeof value?value:!this.get(uid+".enabled")),!0)}},Stratus.PostMessage.Convoy=function(fn){window.addEventListener("message",function(event){if("https://auth.sitetheory.io"!==event.origin)return!1;fn(_.isJSON(event.data)?JSON.parse(event.data):{})},!1)},Stratus.PostMessage.Convoy(function(convoy){let ssoEnabled=_.cookie("sso");(ssoEnabled=null===ssoEnabled||!!_.isJSON(ssoEnabled)&&JSON.parse(ssoEnabled))&&convoy&&convoy.meta&&convoy.meta.session&&convoy.meta.session!==_.cookie("SITETHEORY")&&(_.cookie({name:"SITETHEORY",value:convoy.meta.session,expires:"1w"}),Stratus.Client.safari||window.location.reload(!0))}),Stratus.LocalStorage.Listen=function(key,fn){window.addEventListener("storage",function(event){event.key===key&&fn(event)},!1)},Stratus.LocalStorage.Listen("stratus-core",function(data){}),Stratus.DOM.ready=function(fn){"loading"!==document.readyState?fn():document.addEventListener("DOMContentLoaded",fn)},Stratus.DOM.complete=function(fn){"complete"===document.readyState?fn():window.addEventListener("load",fn)},Stratus.DOM.unload=function(fn){window.addEventListener("beforeunload",fn)},Stratus.Key.Enter=13,Stratus.Key.Escape=27,Stratus.Events.once("initialize",function(){Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Initialize")),Stratus.Internals.LoadEnvironment(),Stratus.Internals.Compatibility(),Stratus.RegisterGroup=new Stratus.Prototypes.Model,Stratus.Internals.TrackLocation(),Stratus.Loaders.Angular()}),Stratus.Events.once("finalize",function(){Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Finalize")),Stratus.Internals.Anchor.initialize&&(Stratus.Internals.Anchor=Stratus.Internals.Anchor());const anchor=new Stratus.Internals.Anchor;Stratus.Environment.get("production")||console.log("Anchor:",anchor),Stratus.RegisterGroup.size()&&Stratus.RegisterGroup.each(function(objs,key){_.has(Stratus.Internals,key)&&(Stratus.Internals[key](objs),Stratus.Environment.get("production")||console.log("Register Group: remove - ",key,objs))})}),Stratus.Events.once("terminate",function(){Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Terminate"))}),Stratus.Events.on("alert",function(event,message,handler){message instanceof Stratus.Prototypes.Bootbox||(message=new Stratus.Prototypes.Bootbox(message,handler)),"undefined"!=typeof bootbox?bootbox.alert(message.message,message.handler):(window.alert(message.message),message.handler())}),Stratus.Events.on("confirm",function(event,message,handler){message instanceof Stratus.Prototypes.Bootbox||(message=new Stratus.Prototypes.Bootbox(message,handler)),"undefined"!=typeof bootbox?bootbox.confirm(message.message,message.handler):handler(window.confirm(message.message))}),Stratus.Events.on("notification",function(event,message,title){const options={};let notification;message&&"object"==typeof message?(_.extend(options,message),options.message=options.message||"Message"):options.message=message||"Message",options.title=options.title||title||"Stratus",options.icon=options.icon||"https://avatars0.githubusercontent.com/u/15791995?v=3&s=200","Notification"in window?"granted"===window.Notification.permission?(notification=new window.Notification(options.title,{body:options.message,icon:options.icon}),Stratus.Environment.get("production")||console.log(notification)):"denied"!==window.Notification.permission&&window.Notification.requestPermission(function(permission){"granted"===permission&&(notification=new window.Notification(options.title,{body:options.message,icon:options.icon}),Stratus.Environment.get("production")||console.log(notification))}):console.info("This browser does not support desktop notifications.  You should switch to a modern browser.")}),Stratus.Events.on("toast",function(event,message,title,priority,settings){message instanceof Stratus.Prototypes.Toast||(message=new Stratus.Prototypes.Toast(message,title,priority,settings)),Stratus.Environment.get("production")||console.log("Toast:",message),void 0!==jQuery&&jQuery.toaster?jQuery.toaster(message):Stratus.Events.trigger("alert",message.message)}),Stratus.DOM.ready(function(){Stratus("body").removeClass("loaded unloaded").addClass("loading"),Stratus.Events.trigger("initialize")}),Stratus.DOM.complete(function(){const renderer=Stratus.Internals.Renderer();Stratus.Environment.set("render",renderer);const qualified={vendors:["NVIDIA Corporation","ATI Technologies Inc.","Qualcomm"],renderers:["NVIDIA","GeForce","AMD","ATI","Radeon","Adreno"]},quality=renderer.vendor&&qualified.vendors.indexOf(renderer.vendor)>=0||renderer.renderer&&_.map(qualified.renderers,renderer=>_.startsWith(renderer,renderer.renderer).length)?"high":"low";Stratus.Environment.set("quality",quality),Stratus("body").removeClass("loading unloaded").addClass(`loaded quality-${quality}`),hamlet.isUndefined("System")||require(["@stratus/angular/boot"])}),Stratus.DOM.unload(function(event){Stratus("body").removeClass("loading loaded").addClass("unloaded"),Stratus.Events.trigger("terminate",event)}),Stratus,Stratus});