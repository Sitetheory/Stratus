//     Stratus.Views.Toggle.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,e){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","text!templates-toggle","stratus.views.widgets.base","bootstrap-toggle"],e):e(t.Stratus,t.$,t._)}(this,function(t,e,i,s){t.Views.Widgets.Toggle=t.Views.Widgets.Base.extend({model:t.Models.Generic,template:i.template(s||""),events:{click:"clickAction"},options:{"private":{autoSave:!1,dataType:null,sliderCss:[t.BaseUrl+"sitetheorystratus/stratus/bower_components/bootstrap-toggle/css/bootstrap-toggle.min.css"],valueType:null},"public":{editable:!0,ui:"checkbox",style:"widget",gradient:!1,icon:null,iconPath:"@SitetheoryCoreBundle:images/icons/actionButtons/visibility.svg",textOn:"Hide",textOff:"Show",emptyValue:!1,classBtn:"btnIcon",classOn:"btnText smallLabel textOn",classOff:"btnText smallLabel textOff",valueOn:!0,valueOff:!1,related:null,relatedInverse:!1,relatedRequire:!1,relatedSync:!1,slider:!1,sliderSize:"normal",sliderOnStyle:"info",sliderOffStyle:"warning",sliderStyle:"",sliderWidth:null,sliderHeight:null}},promise:function(e,i,s){this.options.emptyValue=this.options.valueOff,"icon"===this.options.ui&&this.options.iconPath?t.Internals.Resource(this.options.iconPath,this.element).done(function(o){this.options.icon=o,t.Views.Widgets.Base.prototype.promise.call(this,e,i,s)}.bind(this)):t.Views.Widgets.Base.prototype.promise.call(this,e,i,s)},preOptions:function(t){"slider"===this.$el.dataAttr("ui")&&(this.options["public"].textOn="Enabled",this.options["public"].textOff="Disabled")},postOptions:function(t){"slider"===this.options.ui&&(this.options.ui="checkbox",this.options.slider=!0,this.options.cssFile=i.union(this.options.cssFile,this.options.sliderCss)),this.options.related&&(this.options.ui=this.options.relatedRequire?"radio":this.options.ui),("checkbox"!==this.options.ui||this.options.slider)&&"radio"!==this.options.ui||"undefined"!=typeof this.$el.dataAttr("textOn")||(this.options.textOn=null,this.options.textOff=null),this.options.valueType=typeof this.options.valueOn},validate:function(){return this.$el.dataAttr("property")?"model"!==this.options.dataType||"function"!=typeof this.model||(t.Events.trigger("toast","This widget requires a model that is missing.","Missing Model","danger"),!1):(t.Events.trigger("toast","The data-property attribute is missing.","Missing Data Attribute","danger"),!1)},onRender:function(t){"checkbox"===this.options.ui&&this.options.slider&&(this.scopeChanged(),this.slider=this.$el.find("input"),this.slider.bootstrapToggle({on:this.options.textOn,off:this.options.textOff,size:this.options.sliderSize,onstyle:this.options.sliderOnStyle,offstyle:this.options.sliderOffStyle,style:this.options.sliderStyle,width:this.options.sliderWidth,height:this.options.sliderHeight}))},clickAction:function(t){var e=this.toggleValue();"radio"===this.options.ui&&e===this.getValueOff()||(this.setPropertyValue(e),"model"===this.options.dataType&&this.safeSaveAction({saveNow:!0}),this.setRelated())},scopeChanged:function(t){var e=this.getPropertyValue();return this.setValue(e),"boolean"===this.options.valueType?(this.$el.toggleClass("on",e),this.$el.toggleClass("off",!e)):(this.$el.toggleClass("on on-"+this.options.valueOn,e===this.options.valueOn),this.$el.toggleClass("off off-"+this.options.valueOff,e===this.options.valueOff)),"checkbox"!==this.options.ui&&"radio"!==this.options.ui||(e?this.$element.attr("checked","checked"):this.$element.removeAttr("checked")),!0},toggleValue:function(){var t=this.getPropertyValue();return t="boolean"===this.options.valueType?!(!this.options.related||!this.options.relatedRequire)||!t:this.options.related&&this.options.relatedRequire||t!==this.options.valueOn?this.options.valueOn:this.options.valueOff},getValueOn:function(){return"boolean"===this.options.valueType||this.options.valueOn},getValueOff:function(){return"boolean"!==this.options.valueType&&this.options.valueOff},setValue:function(t){this.$element.closest('[data-type="toggle"]').dataAttr("value",t),this.options.related&&(t===this.getValueOn()?(this.$element.prop("checked",!0),this.$element.attr("checked","checked")):(this.$element.prop("checked",!1),this.$element.removeAttr("checked"))),"var"===this.options.dataType&&e("#app").dataAttr(this.propertyName.toLowerCase(),t)},getValue:function(){var t=this.$el.dataAttr("value");return"undefined"!=typeof t?t:this.getValueOff()},getValueInverse:function(t){return void 0===t&&(t=this.getValue()),t===this.getValueOn()?this.getValueOff():this.getValueOn()},setRelated:function(){if(!this.options.related)return!1;if(this.options.relatedSync)"model"===this.options.dataType&&i.has(this.model,"collection")&&this.model.once("success",function(){this.model.collection.refresh()}.bind(this));else{var t=this.options.relatedInverse?this.getValueInverse():this.getValue();"model"===this.options.dataType&&i.has(this.model,"collection")&&i.each(this.model.collection.models,function(e){this.propertyName in e.attributes&&e.get("id")!==this.model.get("id")&&e.set(this.propertyName,t)}.bind(this))}}})});