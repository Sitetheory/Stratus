System.register(["@angular/core","@angular/forms","@angular/cdk/drag-drop","@angular/cdk/tree","@angular/platform-browser","@angular/material/icon","rxjs","stratus","lodash"],function(t,e){"use strict";var n,r,i,s,a,o,c,h,u,d,f,l=this&&this.__decorate||function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a},g=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},m=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,s){function a(t){try{c(r.next(t))}catch(t){s(t)}}function o(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,o)}c((r=r.apply(t,e||[])).next())})};e&&e.id;return{setters:[function(t){n=t},function(t){r=t},function(t){i=t},function(t){s=t},function(t){a=t},function(t){o=t},function(t){c=t},function(t){h=t},function(t){u=t}],execute:function(){d="/assets/1/0/bundles/sitetheorystratus/stratus/src/angular","@stratus/angular","tree",f=class{constructor(t,e,n){this.ref=n,this.title="tree-dnd",this.selectCtrl=new r.FormControl,this.registry=new h.Data.Registry,this.onChange=new c.Subject,this.treeControl=new s.NestedTreeControl(t=>this.getChildren(t)),this.hasChild=(t,e)=>this.getChildren(e).length>0,this.uid=u.uniqueId("s2_tree_component_"),h.Instances[this.uid]=this;const i=this;this._=u,this.sanitizer=e,t.addSvgIcon("delete",e.bypassSecurityTrustResourceUrl("/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/delete.svg")),h.Internals.CssLoader(`${d}/tree/tree.component.css`),this.fetchData().then(function(t){t.on?(n.detach(),t.on("change",function(){i.dataDefer(i.subscriber),n.detectChanges()}),i.dataDefer(i.subscriber),n.detectChanges()):console.warn("Unable to bind data from Registry!")}),this.dataSub=new c.Observable(t=>this.dataDefer(t))}drop(t){const e=this.dataRef();if(!e||!e.length)return;i.moveItemInArray(e,t.previousIndex,t.currentIndex);let n=0;u.each(e,t=>t.priority=n++),this.model.trigger("change")}remove(t){const e=this.dataRef();if(!e||!e.length)return;const n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.model.trigger("change"))}fetchData(){return m(this,void 0,void 0,function*(){return this.fetched||(this.fetched=this.registry.fetch(h.Select("#content-menu-primary"),this)),this.fetched})}dataDefer(t){this.subscriber=t;const e=this.dataRef();e&&e.length?t.next(e):setTimeout(()=>this.dataDefer(t),500)}dataRef(){if(!this.collection)return[];const t=this.collection.models;return t&&u.isArray(t)?t:[]}onDataChange(t){this.dataDefer(this.subscriber),t.detectChanges()}getChildren(t){return t?u.filter(this.dataRef(),function(e){const n=u.get(t,"data.id"),r=u.get(e,"data.nestParent.id");return n&&r&&n===r}):[]}},f=l([n.Component({selector:"s2-tree",templateUrl:`${d}/tree/tree.component.html`}),g("design:paramtypes",[o.MatIconRegistry,a.DomSanitizer,n.ChangeDetectorRef])],f),t("TreeComponent",f)}}});