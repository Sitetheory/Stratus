System.register(["@angular/core","@angular/forms","@angular/cdk/drag-drop","@angular/cdk/tree","@angular/material/dialog","@angular/platform-browser","@angular/material/icon","rxjs","stratus","lodash"],function(t,e){"use strict";var n,a,r,i,o,s,c,l,h,u,d,f,g,p=this&&this.__decorate||function(t,e,n,a){var r,i=arguments.length,o=i<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,a);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(i<3?r(o):i>3?r(e,n,o):r(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},m=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},y=this&&this.__param||function(t,e){return function(n,a){e(n,a,t)}},b=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))(function(r,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,s)}c((a=a.apply(t,e||[])).next())})};e&&e.id;return{setters:[function(t){n=t},function(t){a=t},function(t){r=t},function(t){i=t},function(t){o=t},function(t){s=t},function(t){c=t},function(t){l=t},function(t){h=t},function(t){u=t}],execute:function(){d="/assets/1/0/bundles/sitetheorystratus/stratus/src/angular","@stratus/angular","tree",f=class{constructor(t,e){this.dialogRef=t,this.data=e}onCancelClick(){this.dialogRef.close()}},f=p([n.Component({selector:"s2-tree-dialog",templateUrl:`${d}/tree/tree.dialog.html`}),y(1,n.Inject(o.MAT_DIALOG_DATA)),m("design:paramtypes",[o.MatDialogRef,Object])],f),t("TreeDialogComponent",f),g=class{constructor(t,e,n,r){this.iconRegistry=t,this.sanitizer=e,this.dialog=n,this.ref=r,this.title="tree-dnd",this.selectCtrl=new a.FormControl,this.registry=new h.Data.Registry,this.onChange=new l.Subject,this.treeControl=new i.NestedTreeControl(t=>t.child||[]),this.hasChild=(t,e)=>e.child&&e.child.length>0,this.uid=u.uniqueId("s2_tree_component_"),h.Instances[this.uid]=this;this._=u,t.addSvgIcon("delete",e.bypassSecurityTrustResourceUrl("/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/delete.svg")),h.Internals.CssLoader(`${d}/tree/tree.component.css`),this.fetchData().then(t=>{t.on?t.on("change",()=>{t.completed&&console.log("Tree collection changed!")}):console.warn("Unable to bind data from Registry!")}),this.dataSub=new l.Observable(t=>this.dataDefer(t))}drop(t){const e=this.dataRef();if(!e||!e.length)return;r.moveItemInArray(e,t.previousIndex,t.currentIndex);let n=0;u.each(e,t=>t.priority=n++),this.model.trigger("change")}remove(t){const e=this.dataRef();if(!e||!e.length)return;const n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.model.trigger("change"))}fetchData(){return b(this,void 0,void 0,function*(){return this.fetched||(this.fetched=this.registry.fetch(h.Select("#content-menu-primary"),this)),this.fetched})}dataDefer(t){this.subscriber=t;const e=this.dataRef();e&&e.length?t.next(e):setTimeout(()=>this.dataDefer(t),500)}dataRef(){if(!this.collection)return[];const t=this.collection.models;if(!t||!u.isArray(t))return[];this.treeMap={};const e=this,n=[];return u.each(t,t=>{const a=u.get(t,"data.id"),r=u.get(t,"data.nestParent.id");u.has(e.treeMap,a)||(e.treeMap[a]={model:null,child:[]}),e.treeMap[a].model=t,r?(u.has(e.treeMap,r)||(e.treeMap[r]={model:null,child:[]}),e.treeMap[r].child.push(e.treeMap[a])):n.push(e.treeMap[a])}),n}onDataChange(t){this.dataDefer(this.subscriber),t.detectChanges()}openDialog(t){if(!t||!u.has(t,"data"))return;this.dialog.open(f,{width:"250px",data:{id:t.data.id||null,name:t.data.name||"",target:t.data.url?"url":"content",content:t.data.content||null,url:t.data.url||null,collection:this.collection||null,parent:t.data.parent||null,nestParent:t.data.nestParent||null}}).afterClosed().subscribe(e=>{t.set({name:e.name,content:e.content,url:e.url}),t.save()})}},g=p([n.Component({selector:"s2-tree",templateUrl:`${d}/tree/tree.component.html`}),m("design:paramtypes",[c.MatIconRegistry,s.DomSanitizer,o.MatDialog,n.ChangeDetectorRef])],g),t("TreeComponent",g)}}});