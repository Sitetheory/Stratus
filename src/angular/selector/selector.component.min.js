System.register(["@angular/core","@angular/forms","@angular/cdk/drag-drop","rxjs","@angular/platform-browser","@angular/material/icon","stratus","lodash"],function(e,t){"use strict";var n,s,r,i,o,c,l,a,u,d,h=this&&this.__decorate||function(e,t,n,s){var r,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function c(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,c)}l((s=s.apply(e,t||[])).next())})};t&&t.id;return{setters:[function(e){n=e},function(e){s=e},function(e){r=e},function(e){i=e},function(e){o=e},function(e){c=e},function(e){l=e},function(e){a=e}],execute:function(){u="/assets/1/0/bundles/sitetheorystratus/stratus/src/angular","@stratus/angular","selector",d=class{constructor(e,t,n){this.ref=n,this.title="selector-dnd",this.selectCtrl=new s.FormControl,this.registry=new l.Data.Registry,this.onChange=new i.Subject,this.url='/Api/Content?q=value&options["showRouting"]',this.target="Content",this.uid=a.uniqueId("s2_selector_component_"),l.Instances[this.uid]=this;const r=this;this._=a,this.sanitizer=t,e.addSvgIcon("delete",t.bypassSecurityTrustResourceUrl("/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/delete.svg")),l.Internals.CssLoader(`${u}/selector/selector.component.css`),this.fetchModel().then(function(e){n.detach(),e.on("change",function(){r.selectedModelDefer(r.subscriber),n.detectChanges()})}),this.selectedModels=new i.Observable(e=>this.selectedModelDefer(e))}drop(e){const t=this.selectedModelRef();if(!t||!t.length)return;r.moveItemInArray(t,e.previousIndex,e.currentIndex);let n=0;a.each(t,e=>e.priority=n++),this.model.trigger("change")}remove(e){const t=this.selectedModelRef();if(!t||!t.length)return;const n=t.indexOf(e);-1!==n&&(t.splice(n,1),this.model.trigger("change"))}fetchModel(){return g(this,void 0,void 0,function*(){return this.fetched||(this.fetched=this.registry.fetch(l.Select("#widget-edit-entity"),this)),this.fetched})}selectedModelDefer(e){this.subscriber=e;const t=this.selectedModelRef();t&&t.length?e.next(t):setTimeout(()=>this.selectedModelDefer(e),500)}selectedModelRef(){if(!this.model)return[];const e=a.get(this.model,"data.version.modules");return e&&a.isArray(e)?e:[]}prioritize(){const e=this.selectedModelRef();if(!e||!e.length)return;let t=0;a.each(e,e=>e.priority=t++)}findImage(e){const t=a.get(e,"version.images[0].mime");return void 0===t?"":-1!==t.indexOf("image")?a.get(e,"version.images[0].src"):-1!==t.indexOf("video")?a.get(e,"version.images[0].meta.thumbnail_small"):""}},d=h([n.Component({selector:"s2-selector-component",templateUrl:`${u}/selector/selector.component.html`}),f("design:paramtypes",[c.MatIconRegistry,o.DomSanitizer,n.ChangeDetectorRef])],d),e("SelectorComponent",d)}}});