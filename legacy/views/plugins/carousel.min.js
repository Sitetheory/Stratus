!function(e,t){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","bootstrap","stratus.views.plugins.base","stratus.views.plugins.onscreen","stratus.views.plugins.lazy"],t):t(e.Stratus,e.$,e._)}(this,function(e,t,s){e.Views.Plugins.Carousel=e.Views.Plugins.Base.extend({initialize:function(t){this.prepare(t);var s=this.$el.find(".carousel-inner > .item");if(this.select=e(this.$el),e.Client.mobile&&this.select.attr("data-groupmobile")?this.batchItems(this.select.attr("data-groupmobile"),s):this.select.attr("data-group")&&this.batchItems(this.select.attr("data-group"),s),this.$el.carousel({interval:this.select.attr("data-interval")||5e3,pause:this.select.attr("data-pause")||"hover",wrap:this.select.attr("data-wrap")||!0,keyboard:this.select.attr("data-keyboard")||!0}),this.$el.on("slid.bs.carousel",function(){!1===e.Environment.get("viewPortChange")&&e.Environment.set("viewPortChange",!0)}),!1!==this.select.attr("data-startonscreen")){this.$el.carousel("pause");var a=this;this.onScreen=new e.Views.Plugins.OnScreen({el:this.el,onScreen:function(){a.$el.carousel("cycle")},offScreen:function(){a.$el.carousel("pause")}})}},batchItems:function(e,a){e=e<=0?1:e;var i=Math.round(12/e),n=this.select.attr("data-colminsize")?this.select.attr("data-colminsize"):"xs";if(e>1){var r=this.$el.find(".carousel-inner");r.empty()}var l=!1;s.each(a,function(a,c){if(e>1){var o,u=0,h=r.children(".item");h.length>0&&(u=(o=t(s.last(h))).children(".nestedItem").length),(!u||u>=e)&&(o=t('<div class="item carousel-item"></div>'),r.append(o)),t(a).removeClass("item carousel-item").addClass("nestedItem col-"+n+"-"+i),o.append(t(a)),t(a).hasClass("active")&&(l=!0,o.addClass("active"))}else t(a).hasClass("active")&&(l=!0)}),l||t(s.first(this.$el.find(".carousel-inner .item"))).addClass("active")}})});