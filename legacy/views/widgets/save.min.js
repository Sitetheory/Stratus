!function(t,i){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","stratus.views.widgets.base"],i):i(t.Stratus,t.$,t._)}(this,function(t,i,e){t.Views.Widgets.Save=t.Views.Widgets.Base.extend({template:e.template('{% if (options.icon) { %}{% if (options.gradient) { %}<div class="{{ options.gradient }}"></div>{% } %}<span id="{{ elementId }}" class="{{ options.classBtn }}">{{ options.icon }}</span>{% } %}{% if (options.textOn || options.textOff) { %}<span class="{{ options.classOn}}">{{ options.textOn }}</span><span class="{{ options.classOff}}">{{ options.textOff }}</span>{% } %}'),events:{click:"saveNowAction"},options:{private:{forceType:"model"},public:{editable:!1,action:null,iconPath:"@SitetheoryCoreBundle:images/icons/actionButtons/save.svg",gradient:null,textOff:"Save",textOn:"",classBtn:"btnIcon",classOff:"btnText smallLabel textOff",classOn:"btnText smallLabel textOn glyphicon glyphicon-ok success"}},originalId:null,_prevState:null,promise:function(i,e,s){this.options.iconPath?t.Internals.Resource(this.options.iconPath,this.element).then(function(n){this.options.icon=n,t.Views.Widgets.Base.prototype.promise.call(this,i,e,s)}.bind(this)):t.Views.Widgets.Base.prototype.promise.call(this,i,e,s)},preOptions:function(t){this.model&&"object"==typeof this.model&&(this.originalId=this.model.get("id"))},onRender:function(t){this.options.action&&this.$el.addClass("action"+e.ucfirst(this.options.action)),this.scopeChanged()},onRegister:function(){return i(window).bind("keydown",function(t){this.saveKey(t)}.bind(this)),this.model.on("save",this.onSave,this),t.Views.Widgets.Base.prototype.onRegister.call(this)},saveNowAction:function(t){return"version"===this.options.action?(this.model.meta.temp("apiSpecialAction","iterateVersion"),this.model.set("timeEdit","API::NOW")):"duplicate"===this.options.action&&(this.model.meta.temp("apiSpecialAction","duplicate"),this.model.set("timeEdit","API::NOW")),e.size(this.model.patch)&&this.model.trigger("save"),this.scopeChanged(),!0},scopeChanged:function(){if(this.model.get("id")!==this.originalId){var i=window.location.toString(),s=i.replace(/id=[0-9]+/,"id="+this.model.get("id"));s===i&&(s=null===this.originalId?t.Internals.SetUrlParams({id:this.model.get("id")}):this.model.get("routingPrimary.url")),s&&window.location.replace(s)}this.primeChanges(!e.size(this.model.patch)||this.model.hasChanged("timeStatus")||this.model.hasChanged("timeEdit")&&"API::NOW"!==this.model.get("timEdit"))},primeChanges:function(t){this._stateChanging||this._prevState===t||(this._stateChanging=!t,this.$el.toggleClass("on",t),this.$el.toggleClass("off",!t))},onSave:function(t){this.model.once("success",function(){this.model.once("change",function(){this._stateChanging=!1,this.scopeChanged()},this)},this)},saveKey:function(t){if(t.ctrlKey||t.metaKey)switch(String.fromCharCode(t.which).toLowerCase()){case"s":t.preventDefault(),this.saveNowAction({})}return!0}})});