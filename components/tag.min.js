!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","angular-material","stratus.services.registry","stratus.services.model","stratus.services.collection","stratus.components.pagination","stratus.components.search"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,function(Stratus,_,jQuery,angular){const min=Stratus.Environment.get("production")?".min":"";Stratus.Components.Tag={transclude:{model:"?stratusBaseModel"},bindings:{elementId:"@",ngModel:"=",property:"@",target:"@",id:"@",manifest:"@",decouple:"@",direct:"@",api:"@",urlRoot:"@",limit:"@",options:"<"},controller:function($scope,$attrs,Registry,Model,Collection){Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/tag"+min+".css");const $ctrl=this;$ctrl.uid=_.uniqueId(_.camelToSnake("tag")+"_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/tag"+min+".css"),$scope.initialized=!1,$ctrl.$onInit=function(){$ctrl.selectedChips=[],$ctrl.queryText="",$ctrl.registry=new Registry,$ctrl.registry.fetch({target:$attrs.target||"Tag",id:null,manifest:!1,decouple:!0,direct:!0},$scope)},$scope.$watch("$ctrl.ngModel",function(data){$ctrl.selectedChips=data||[],data instanceof Model&&data!==$scope.model?$scope.model=data:data instanceof Collection&&data!==$scope.collection&&($scope.collection=data)}),$ctrl.isDisabled=function(chip){return-1!==$ctrl.selectedChips.findIndex(function(x){return x.name.toLowerCase()===chip.name.toLowerCase()})},$ctrl.disableTag=function($event){$event.stopPropagation(),$event.preventDefault()},$ctrl.queryData=function(){let results=$scope.collection.filter($ctrl.queryText);$scope.status=!0;let query=$ctrl.queryText.toLowerCase();return Promise.resolve(results).then(function(value){let returnArr=value.filter(function(item){let lower=item.name.toLowerCase();if(""===$ctrl.queryText||-1!==lower.indexOf(query))return $scope.status});if(returnArr.length>0&&-1===returnArr.findIndex(mainArr=>mainArr.name.toLowerCase()===$ctrl.queryText.toLowerCase())){var obj={isNew:"true",name:$ctrl.queryText};returnArr.push(obj)}return returnArr})},$ctrl.transformChip=function(chip){return angular.isObject(chip)?chip:{name:chip}},$ctrl.createTag=function(query){new Model({target:"Tag"},{name:query}).save().then(function(response){}).catch(function(error,response){console.error(error)}),$ctrl.queryText="",jQuery("input").blur()}},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/tag"+(Stratus.Environment.get("production")?".min":"")+".html"}});